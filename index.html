<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PC Builder Tycoon - Admin Edition</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: #0a0a14;
            color: #e0e0e0;
            min-height: 100vh;
        }
        
        /* Auth Screen */
        .auth-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a14 0%, #1a1a2e 50%, #16213e 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        
        .auth-container {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 450px;
            backdrop-filter: blur(10px);
        }
        
        .auth-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .auth-logo h1 {
            font-size: 2em;
            background: linear-gradient(90deg, #4f46e5, #7c3aed, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .auth-logo p {
            color: #9ca3af;
            font-size: 0.9em;
        }
        
        .auth-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }
        
        .auth-tab {
            flex: 1;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border: 2px solid transparent;
            color: #9ca3af;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .auth-tab:hover { background: rgba(255,255,255,0.1); }
        .auth-tab.active { 
            border-color: #4f46e5; 
            color: #fff; 
            background: rgba(79, 70, 229, 0.2);
        }
        
        .auth-form { display: none; }
        .auth-form.active { display: block; animation: fadeIn 0.3s; }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #9ca3af;
            font-size: 0.9em;
        }
        
        .form-group input {
            width: 100%;
            padding: 14px;
            background: rgba(0,0,0,0.3);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            color: #fff;
            font-size: 1em;
            transition: all 0.3s;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #4f46e5;
        }
        
        .form-group input.error {
            border-color: #ef4444;
            animation: shake 0.5s;
        }
        
        .password-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }
        
        .password-wrapper input {
            flex: 1;
            padding-right: 50px;
        }
        
        .toggle-password {
            position: absolute;
            right: 10px;
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            font-size: 1.2em;
            padding: 5px;
            transition: color 0.3s;
        }
        
        .toggle-password:hover {
            color: #fff;
        }
        
        .password-strength {
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
        }
        
        .password-strength-fill {
            height: 100%;
            transition: all 0.3s;
            border-radius: 2px;
        }
        
        .strength-weak { background: #ef4444; width: 33%; }
        .strength-medium { background: #f59e0b; width: 66%; }
        .strength-strong { background: #10b981; width: 100%; }
        
        .auth-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
            border: none;
            border-radius: 10px;
            color: #fff;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .auth-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(79, 70, 229, 0.3); }
        .auth-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        
        .auth-error {
            color: #ef4444;
            font-size: 0.9em;
            margin-top: 15px;
            text-align: center;
            display: none;
        }
        
        .auth-success {
            color: #10b981;
            font-size: 0.9em;
            margin-top: 15px;
            text-align: center;
            display: none;
        }
        
        .admin-badge {
            display: inline-block;
            background: linear-gradient(90deg, #dc2626, #991b1b);
            color: #fff;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 700;
            margin-left: 10px;
            animation: pulse 2s infinite;
        }
        
        .user-badge {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255,255,255,0.1);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #dc2626, #991b1b);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9em;
        }
        
        .logout-btn {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid #ef4444;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.75em;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .logout-btn:hover { background: #ef4444; color: #fff; }
        
        /* Admin Panel Styles */
        .admin-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 10002;
            overflow-y: auto;
        }
        
        .admin-panel.active { display: block; }
        
        .admin-header {
            background: linear-gradient(90deg, #dc2626, #991b1b);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .admin-content {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .admin-section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(220, 38, 38, 0.3);
        }
        
        .admin-title {
            color: #ef4444;
            font-size: 1.3em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .admin-card {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .admin-input {
            width: 100%;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            color: #fff;
            margin-bottom: 10px;
        }
        
        .admin-btn {
            padding: 10px 20px;
            background: #dc2626;
            color: #fff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .admin-btn:hover { background: #b91c1c; }
        
        .admin-close {
            background: rgba(255,255,255,0.1);
            border: none;
            color: #fff;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
        }
        
        .admin-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #dc2626;
            color: #fff;
            border: none;
            padding: 15px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            z-index: 9999;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.4);
        }
        
        .admin-toggle:hover { transform: scale(1.1); }
        
        /* Main Game Styles */
        .header {
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .header h1 { font-size: 1.4em; }
        
        .stats {
            display: flex;
            gap: 15px;
            font-size: 0.9em;
            flex-wrap: wrap;
        }
        
        .stat { display: flex; align-items: center; gap: 5px; }
        .stat-value { font-weight: 700; }
        .money { color: #10b981; }
        .debt { color: #ef4444; }
        .rep { color: #f59e0b; }
        .level { color: #60a5fa; }
        .xp { color: #a78bfa; }
        .day { color: #ec4899; }
        
        .nav-tabs {
            display: flex;
            gap: 5px;
            padding: 10px 20px;
            background: rgba(0,0,0,0.3);
            overflow-x: auto;
        }
        
        .nav-tab {
            padding: 10px 20px;
            background: rgba(255,255,255,0.1);
            border: none;
            color: #9ca3af;
            border-radius: 8px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s;
            font-size: 0.9em;
        }
        
        .nav-tab:hover { background: rgba(255,255,255,0.2); color: #fff; }
        .nav-tab.active { background: #4f46e5; color: #fff; }
        .nav-tab:disabled { opacity: 0.3; cursor: not-allowed; }
        .nav-tab.pulse { animation: pulse 2s infinite; background: #ef4444; }
        
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        
        .container { padding: 20px; max-width: 1400px; margin: 0 auto; }
        .tab-panel { display: none; }
        .tab-panel.active { display: block; animation: fadeIn 0.3s; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .level-bar {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .level-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: 700;
        }
        
        .level-info { flex: 1; min-width: 200px; }
        .level-title { font-size: 1.1em; font-weight: 700; margin-bottom: 5px; }
        .level-desc { font-size: 0.85em; color: #9ca3af; }
        
        .xp-bar {
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }
        
        .xp-fill {
            height: 100%;
            background: linear-gradient(90deg, #4f46e5, #a78bfa);
            transition: width 0.3s;
        }
        
        .build-section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .section-title {
            color: #a78bfa;
            font-size: 1.2em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .build-slots {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .build-slot {
            background: rgba(0,0,0,0.3);
            border: 2px dashed rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
        }
        
        .build-slot:hover { border-color: #6366f1; background: rgba(99, 102, 241, 0.1); }
        .build-slot.filled { border-style: solid; border-color: #10b981; background: rgba(16, 185, 129, 0.1); }
        .build-slot.active { border-color: #f59e0b; background: rgba(245, 158, 11, 0.1); }
        .build-slot.error { border-color: #ef4444; background: rgba(239, 68, 68, 0.1); animation: shake 0.5s; }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .slot-label { font-size: 0.7em; color: #9ca3af; text-transform: uppercase; margin-bottom: 5px; }
        .slot-value { font-weight: 600; font-size: 0.85em; word-break: break-word; }
        .slot-price { color: #10b981; font-size: 0.75em; margin-top: 3px; }
        .slot-size { color: #60a5fa; font-size: 0.7em; margin-top: 2px; }
        .slot-error { color: #ef4444; font-size: 0.7em; margin-top: 3px; }
        
        .components-section {
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }
        
        .components-section.active { display: block; animation: slideUp 0.3s; }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .components-title {
            color: #f59e0b;
            font-size: 1.1em;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .components-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 12px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .component-card {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .component-card:hover { border-color: #6366f1; transform: translateY(-2px); }
        .component-card.selected { border-color: #10b981; background: rgba(16, 185, 129, 0.1); }
        .component-card.locked { opacity: 0.4; pointer-events: none; }
        .component-card.incompatible { border-color: #ef4444; opacity: 0.7; }
        
        .comp-tier {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.65em;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 6px;
        }
        
        .tier-budget { background: #6b7280; }
        .tier-mid { background: #3b82f6; }
        .tier-high { background: #8b5cf6; }
        .tier-enthusiast { background: #f59e0b; color: #000; }
        .tier-extreme { background: #ec4899; }
        
        .comp-brand { color: #8b5cf6; font-size: 0.7em; text-transform: uppercase; }
        .comp-name { font-weight: 700; margin: 4px 0; font-size: 0.9em; }
        .comp-specs { font-size: 0.75em; color: #9ca3af; margin-bottom: 8px; line-height: 1.3; }
        .comp-price { color: #10b981; font-weight: 700; font-size: 1em; }
        .comp-error { color: #ef4444; font-size: 0.75em; margin-top: 5px; }
        .comp-size { color: #60a5fa; font-size: 0.75em; margin-top: 3px; }
        
        .build-summary {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }
        
        .summary-item { text-align: center; }
        .summary-label { font-size: 0.8em; color: #9ca3af; }
        .summary-value { font-size: 1.3em; font-weight: 700; }
        
        .power-status {
            padding: 10px 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .power-ok { background: rgba(16, 185, 129, 0.2); color: #10b981; border: 1px solid #10b981; }
        .power-warn { background: rgba(245, 158, 11, 0.2); color: #f59e0b; border: 1px solid #f59e0b; }
        .power-error { background: rgba(239, 68, 68, 0.2); color: #ef4444; border: 1px solid #ef4444; }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 1em;
        }
        
        .btn-primary { background: #4f46e5; color: white; }
        .btn-success { background: #10b981; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-warning { background: #f59e0b; color: #000; }
        .btn-info { background: #3b82f6; color: white; }
        .btn:hover { transform: translateY(-2px); opacity: 0.9; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        
        .btn-row { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
        
        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .item-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            border-left: 4px solid #6366f1;
        }
        
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .item-title { font-weight: 700; }
        .item-price { color: #10b981; font-weight: 700; }
        
        .item-details { font-size: 0.85em; color: #9ca3af; margin-bottom: 10px; }
        
        .btn-small {
            padding: 8px 15px;
            font-size: 0.85em;
            border-radius: 6px;
        }
        
        .loan-panel {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .loan-active {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid #ef4444;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .loan-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .loan-control { margin-bottom: 20px; }
        
        .loan-control label {
            display: block;
            margin-bottom: 8px;
            color: #9ca3af;
            font-size: 0.9em;
        }
        
        .loan-value {
            font-size: 1.5em;
            font-weight: 700;
            color: #a78bfa;
            margin-bottom: 10px;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: rgba(255,255,255,0.1);
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #6366f1;
            cursor: pointer;
        }
        
        input[type="number"] {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: #fff;
            padding: 10px;
            border-radius: 8px;
            width: 100%;
            font-size: 1em;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .info-box {
            text-align: center;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }
        
        .info-label { font-size: 0.8em; color: #9ca3af; }
        .info-value { font-size: 1.2em; font-weight: 700; margin-top: 5px; }
        
        .workers-section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .worker-card {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #10b981;
        }
        
        .worker-card.locked {
            opacity: 0.5;
            border-left-color: #6b7280;
        }
        
        .worker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .worker-name { font-weight: 700; font-size: 1.1em; }
        .worker-salary { color: #ef4444; font-weight: 600; }
        
        .worker-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 10px 0;
            font-size: 0.85em;
        }
        
        .worker-stat { text-align: center; }
        .worker-stat-value { color: #60a5fa; font-weight: 700; }
        
        .unlock-requirement {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin-top: 10px;
            font-size: 0.9em;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .modal.active { display: flex; }
        
        .modal-content {
            background: #1e1e2e;
            border-radius: 15px;
            padding: 25px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
        
        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: #fff;
            font-size: 1.5em;
            cursor: pointer;
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            transform: translateY(100px);
            transition: transform 0.3s;
            z-index: 2000;
        }
        
        .notification.show { transform: translateY(0); }
        .notification.success { background: #10b981; }
        .notification.error { background: #ef4444; }
        .notification.warning { background: #f59e0b; color: #000; }
        .notification.info { background: #3b82f6; }
        
        .hint {
            text-align: center;
            color: #9ca3af;
            font-size: 0.9em;
            margin-top: 10px;
        }
        
        .compatibility-info {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
        
        .compat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .compat-row:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        
        .compat-ok { color: #10b981; }
        .compat-error { color: #ef4444; }
        .compat-warn { color: #f59e0b; }
        
        .cooler-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            justify-content: center;
        }
        
        .cooler-tab {
            padding: 8px 20px;
            background: rgba(255,255,255,0.1);
            border: none;
            color: #9ca3af;
            border-radius: 6px;
            cursor: pointer;
        }
        
        .cooler-tab.active {
            background: #6366f1;
            color: #fff;
        }
        
        .next-payment {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid #ef4444;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
            text-align: center;
            color: #ef4444;
        }
        
        /* NPC Orders */
        .npc-list {
            display: grid;
            gap: 15px;
        }
        
        .npc-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #f59e0b;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .npc-card:hover {
            background: rgba(255,255,255,0.08);
            transform: translateX(5px);
        }
        
        .npc-card.processing {
            border-left-color: #3b82f6;
            opacity: 0.7;
        }
        
        .npc-card.ready {
            border-left-color: #10b981;
            animation: pulseGreen 2s infinite;
        }
        
        @keyframes pulseGreen {
            0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            50% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
        }
        
        .npc-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .npc-name { font-weight: 700; font-size: 1.2em; }
        .npc-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
        }
        
        .status-waiting { background: #f59e0b; color: #000; }
        .status-processing { background: #3b82f6; color: #fff; }
        .status-ready { background: #10b981; color: #fff; }
        
        .npc-request {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .npc-request-title {
            color: #a78bfa;
            font-size: 0.9em;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .npc-component {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 0.9em;
        }
        
        .npc-component:last-child { border-bottom: none; }
        
        .npc-total {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 8px;
            margin-top: 10px;
            font-weight: 700;
        }
        
        .npc-price-section {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .price-input-row {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .price-input-row label {
            min-width: 120px;
            color: #9ca3af;
        }
        
        .price-display {
            font-size: 1.3em;
            font-weight: 700;
            color: #10b981;
        }
        
        .profit-display {
            font-size: 1em;
            color: #60a5fa;
        }
        
        .deadline-input {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 10px;
        }
        
        .deadline-input label {
            min-width: 120px;
            color: #9ca3af;
        }
        
        .deadline-display {
            color: #f59e0b;
            font-weight: 600;
        }
        
        .npc-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .npc-hint {
            font-size: 0.85em;
            color: #9ca3af;
            margin-top: 10px;
            font-style: italic;
        }
        
        .npc-hint.warning { color: #ef4444; }
        .npc-hint.success { color: #10b981; }
        
        .urgent-indicator {
            display: inline-block;
            background: #ef4444;
            color: #fff;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            margin-left: 10px;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .reputation-bar {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            font-size: 0.85em;
        }
        
        .rep-indicator {
            width: 100px;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .rep-fill {
            height: 100%;
            background: linear-gradient(90deg, #ef4444, #f59e0b, #10b981);
            transition: width 0.3s;
        }
        
        /* Showcase */
        .showcase-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }
        
        .showcase-item {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid rgba(255,255,255,0.1);
            position: relative;
        }
        
        .showcase-item:hover {
            border-color: #6366f1;
        }
        
        .showcase-item.reserved {
            border-color: #f59e0b;
            background: rgba(245, 158, 11, 0.05);
        }
        
        .showcase-badge {
            position: absolute;
            top: -10px;
            right: 10px;
            background: #10b981;
            color: #fff;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 700;
        }
        
        .showcase-badge.reserved {
            background: #f59e0b;
            color: #000;
        }
        
        .showcase-price {
            font-size: 1.5em;
            color: #10b981;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .showcase-profit {
            color: #60a5fa;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        
        .showcase-components {
            font-size: 0.85em;
            color: #9ca3af;
            margin-bottom: 15px;
            max-height: 100px;
            overflow-y: auto;
        }
        
        .showcase-actions {
            display: flex;
            gap: 10px;
        }
        
        .discount-badge {
            background: #ef4444;
            color: #fff;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            margin-left: 10px;
        }
        
        /* Worker Tasks */
        .tasks-section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .task-card {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #3b82f6;
        }
        
        .task-card.completed {
            border-left-color: #10b981;
            opacity: 0.7;
        }
        
        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .task-type {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
        }
        
        .task-showcase { background: #8b5cf6; }
        .task-order { background: #f59e0b; color: #000; }
        
        .progress-bar {
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            transition: width 0.3s;
        }
        
        /* Customer Queue */
        .queue-section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .customer-card {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .customer-waiting {
            border-left: 4px solid #f59e0b;
        }
        
        .customer-ready {
            border-left: 4px solid #10b981;
        }
        
        .customer-info {
            flex: 1;
        }
        
        .customer-name {
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .customer-status {
            font-size: 0.85em;
            color: #9ca3af;
        }
        
        .customer-action {
            margin-left: 15px;
        }
        
        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0a0a14;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 10001;
        }
        
        .loading-screen.active { display: flex; }
        
        .loader {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(79, 70, 229, 0.3);
            border-top-color: #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: #9ca3af;
            font-size: 1.1em;
        }
        
        /* Player Build Section in NPC Orders */
        .player-build-section {
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid #10b981;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .player-build-title {
            color: #10b981;
            font-size: 1.1em;
            margin-bottom: 15px;
            font-weight: 700;
        }

        /* Change Password Button in Header */
        .change-pass-btn {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border: 1px solid #f59e0b;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.75em;
            cursor: pointer;
            transition: all 0.3s;
            margin-left: 5px;
        }
        
        .change-pass-btn:hover { background: #f59e0b; color: #000; }

        /* Profile Modal */
        .profile-section {
            margin-bottom: 20px;
        }
        
        .profile-info {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .profile-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .profile-row:last-child { border-bottom: none; }

        /* Admin User Management Styles */
        .admin-user-list {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .admin-user-card {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s;
        }

        .admin-user-card:hover {
            border-color: #dc2626;
            background: rgba(220, 38, 38, 0.1);
        }

        .admin-user-card.admin {
            border-color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }

        .admin-user-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .admin-user-name {
            font-weight: 700;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-user-badge {
            background: #f59e0b;
            color: #000;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7em;
            font-weight: 700;
        }

        .admin-user-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            font-size: 0.85em;
            margin-bottom: 10px;
        }

        .admin-user-stat {
            text-align: center;
            padding: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
        }

        .admin-user-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .admin-user-btn {
            padding: 6px 12px;
            font-size: 0.8em;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .admin-user-btn:hover {
            transform: translateY(-1px);
        }

        .admin-user-btn.give-money {
            background: #10b981;
            color: #fff;
        }

        .admin-user-btn.give-xp {
            background: #8b5cf6;
            color: #fff;
        }

        .admin-user-btn.make-admin {
            background: #f59e0b;
            color: #000;
        }

        .admin-user-btn.remove-admin {
            background: #ef4444;
            color: #fff;
        }

        .admin-user-btn.delete {
            background: #7f1d1d;
            color: #fff;
        }

        .admin-user-btn.view-pass {
            background: #3b82f6;
            color: #fff;
        }

        .admin-password-display {
            font-family: monospace;
            background: rgba(0,0,0,0.5);
            padding: 8px 12px;
            border-radius: 4px;
            margin-top: 8px;
            font-size: 0.9em;
            color: #10b981;
            word-break: break-all;
        }

        .admin-search {
            width: 100%;
            padding: 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: #fff;
            margin-bottom: 15px;
            font-size: 1em;
        }

        .admin-search:focus {
            outline: none;
            border-color: #dc2626;
        }

        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
        }

        .admin-tab-btn {
            padding: 10px 20px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: #9ca3af;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .admin-tab-btn:hover {
            background: rgba(255,255,255,0.1);
            color: #fff;
        }

        .admin-tab-btn.active {
            background: #dc2626;
            color: #fff;
            border-color: #dc2626;
        }

        .admin-panel-content {
            display: none;
        }

        .admin-panel-content.active {
            display: block;
        }

        .admin-log-entry {
            background: rgba(0,0,0,0.3);
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 8px;
            font-size: 0.85em;
            border-left: 3px solid #dc2626;
        }

        .admin-log-time {
            color: #9ca3af;
            font-size: 0.8em;
        }

        .admin-log-action {
            color: #fff;
            margin-top: 4px;
        }

        .admin-gift-panel {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .admin-gift-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .admin-gift-row label {
            min-width: 120px;
            color: #9ca3af;
        }

        .admin-gift-row input {
            flex: 1;
            padding: 8px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 4px;
            color: #fff;
        }

        .admin-gift-row button {
            padding: 8px 16px;
            background: #10b981;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .admin-gift-row button:hover {
            background: #059669;
        }

        /* Creator Badge */
        .creator-badge {
            display: inline-block;
            background: linear-gradient(90deg, #dc2626, #f59e0b);
            color: #fff;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 700;
            margin-left: 10px;
            animation: pulse 2s infinite;
            text-shadow: 0 0 10px rgba(220, 38, 38, 0.5);
        }

        .admin-user-card.creator {
            border-color: #dc2626;
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.2), rgba(245, 158, 11, 0.1));
            box-shadow: 0 0 20px rgba(220, 38, 38, 0.3);
        }

        /* Gift Modal Styles */
        .gift-modal-content {
            max-width: 450px;
        }

        .gift-input-group {
            margin-bottom: 15px;
        }

        .gift-input-group label {
            display: block;
            margin-bottom: 8px;
            color: #9ca3af;
            font-size: 0.9em;
        }

        .gift-input-group input {
            width: 100%;
            padding: 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: #fff;
            font-size: 1em;
        }

        .gift-input-group input:focus {
            outline: none;
            border-color: #4f46e5;
        }
    </style>
</head>
<body>
    <!-- Auth Screen -->
    <div class="auth-screen" id="authScreen">
        <div class="auth-container">
            <div class="auth-logo">
                <h1>‚ö° PC Builder Tycoon</h1>
                <p>–ê–¥–º–∏–Ω-–≤–µ—Ä—Å–∏—è. –í—Ö–æ–¥ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.</p>
            </div>
            
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')">–í—Ö–æ–¥</button>
                <button class="auth-tab" onclick="switchAuthTab('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </div>
            
            <!-- Login Form -->
            <form class="auth-form active" id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <input type="text" id="loginUsername" required placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" autocomplete="username">
                </div>
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å</label>
                    <div class="password-wrapper">
                        <input type="password" id="loginPassword" required placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" autocomplete="current-password">
                        <button type="button" class="toggle-password" onclick="togglePassword('loginPassword', this)">üëÅÔ∏è</button>
                    </div>
                </div>
                <button type="submit" class="auth-btn">–í–æ–π—Ç–∏ –≤ –∏–≥—Ä—É</button>
                <div class="auth-error" id="loginError"></div>
            </form>
            
            <!-- Register Form -->
            <form class="auth-form" id="registerForm" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <input type="text" id="regUsername" required placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –∏–º—è" autocomplete="username">
                </div>
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å</label>
                    <div class="password-wrapper">
                        <input type="password" id="regPassword" required placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å" minlength="6" oninput="checkPasswordStrength('regPassword')">
                        <button type="button" class="toggle-password" onclick="togglePassword('regPassword', this)">üëÅÔ∏è</button>
                    </div>
                    <div class="password-strength">
                        <div class="password-strength-fill" id="regPasswordStrength"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                    <div class="password-wrapper">
                        <input type="password" id="regConfirmPassword" required placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                        <button type="button" class="toggle-password" onclick="togglePassword('regConfirmPassword', this)">üëÅÔ∏è</button>
                    </div>
                </div>
                <button type="submit" class="auth-btn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                <div class="auth-error" id="registerError"></div>
                <div class="auth-success" id="registerSuccess"></div>
            </form>
        </div>
    </div>
    
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loader"></div>
        <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã...</div>
    </div>

    <!-- Admin Panel -->
    <div class="admin-panel" id="adminPanel">
        <div class="admin-header">
            <h2>üî¥ –ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª—å</h2>
            <button class="admin-close" onclick="toggleAdminPanel()">–ó–∞–∫—Ä—ã—Ç—å ‚úï</button>
        </div>
        <div class="admin-content">
            <!-- Admin Tabs -->
            <div class="admin-tabs">
                <button class="admin-tab-btn active" onclick="switchAdminTab('quick')">‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</button>
                <button class="admin-tab-btn" onclick="switchAdminTab('users')">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
                <button class="admin-tab-btn" onclick="switchAdminTab('logs')">üìã –õ–æ–≥–∏</button>
            </div>

            <!-- Quick Actions Tab -->
            <div class="admin-panel-content active" id="adminTab-quick">
                <div class="admin-section">
                    <div class="admin-title">‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</div>
                    <div class="admin-grid">
                        <div class="admin-card">
                            <label>–î–æ–±–∞–≤–∏—Ç—å –¥–µ–Ω–µ–≥</label>
                            <input type="number" class="admin-input" id="adminAddMoney" placeholder="–°—É–º–º–∞" value="100000">
                            <button class="admin-btn" onclick="adminAddMoney()">–î–æ–±–∞–≤–∏—Ç—å</button>
                        </div>
                        <div class="admin-card">
                            <label>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å</label>
                            <input type="number" class="admin-input" id="adminSetLevel" placeholder="–£—Ä–æ–≤–µ–Ω—å" min="1" max="8" value="1">
                            <button class="admin-btn" onclick="adminSetLevel()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                        </div>
                        <div class="admin-card">
                            <label>–î–æ–±–∞–≤–∏—Ç—å XP</label>
                            <input type="number" class="admin-input" id="adminAddXP" placeholder="XP" value="1000">
                            <button class="admin-btn" onclick="adminAddXP()">–î–æ–±–∞–≤–∏—Ç—å</button>
                        </div>
                        <div class="admin-card">
                            <label>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–µ–ø—É—Ç–∞—Ü–∏—é</label>
                            <input type="number" class="admin-input" id="adminSetRep" placeholder="–†–µ–ø—É—Ç–∞—Ü–∏—è" value="100">
                            <button class="admin-btn" onclick="adminSetRep()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                        </div>
                    </div>
                </div>
                
                <div class="admin-section">
                    <div class="admin-title">üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–π</div>
                    <div class="admin-grid">
                        <div class="admin-card">
                            <button class="admin-btn" onclick="adminClearDebt()">üßπ –û—á–∏—Å—Ç–∏—Ç—å –¥–æ–ª–≥–∏</button>
                        </div>
                        <div class="admin-card">
                            <button class="admin-btn" onclick="adminUnlockAll()">üîì –û—Ç–∫—Ä—ã—Ç—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏</button>
                        </div>
                        <div class="admin-card">
                            <button class="admin-btn" onclick="adminResetGame()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</button>
                        </div>
                        <div class="admin-card">
                            <button class="admin-btn" onclick="adminGenerateNPC()">üë• –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å 5 –∑–∞–∫–∞–∑–æ–≤</button>
                        </div>
                    </div>
                </div>
                
                <div class="admin-section">
                    <div class="admin-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                    <div class="admin-grid" id="adminStats">
                        <!-- Stats will be filled by JS -->
                    </div>
                </div>
            </div>

            <!-- Users Management Tab -->
            <div class="admin-panel-content" id="adminTab-users">
                <div class="admin-section">
                    <div class="admin-title">üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</div>
                    <input type="text" class="admin-search" id="userSearch" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏..." oninput="filterUsers()">
                    <div class="admin-user-list" id="adminUserList">
                        <!-- Users will be filled by JS -->
                    </div>
                </div>
            </div>

            <!-- Logs Tab -->
            <div class="admin-panel-content" id="adminTab-logs">
                <div class="admin-section">
                    <div class="admin-title">üìã –õ–æ–≥–∏ –¥–µ–π—Å—Ç–≤–∏–π</div>
                    <div style="margin-bottom: 15px;">
                        <button class="admin-btn" onclick="clearLogs()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
                    </div>
                    <div class="admin-user-list" id="adminLogsList">
                        <!-- Logs will be filled by JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Toggle Button -->
    <button class="admin-toggle" id="adminToggle" onclick="toggleAdminPanel()">üî¥</button>

    <!-- Main Game -->
    <div id="gameContainer" style="display: none;">
        <div class="header">
            <div class="header-top">
                <h1>‚ö° PC Builder Tycoon</h1>
                <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                    <div class="user-badge" id="userBadge">
                        <div class="user-avatar" id="userAvatar">A</div>
                        <span id="usernameDisplay">admin</span>
                        <span id="adminBadge" class="admin-badge" style="display: none;">ADMIN</span>
                    </div>
                    <button class="change-pass-btn" onclick="openChangePasswordModal()">üîë –ü–∞—Ä–æ–ª—å</button>
                    <button class="logout-btn" onclick="logout()">–í—ã–π—Ç–∏</button>
                    <div class="stats">
                        <div class="stat">
                            <span>üí∞</span>
                            <span class="stat-value money" id="balance">‚Ç°100,000</span>
                        </div>
                        <div class="stat" id="debtStat" style="display: none;">
                            <span>üí≥</span>
                            <span class="stat-value debt" id="debt">‚Ç°0</span>
                        </div>
                        <div class="stat">
                            <span>‚≠ê</span>
                            <span class="stat-value rep" id="reputation">25</span>
                        </div>
                        <div class="stat">
                            <span>üèÜ</span>
                            <span class="stat-value level" id="level">1</span>
                        </div>
                        <div class="stat">
                            <span>üìà</span>
                            <span class="stat-value xp" id="xp">0/100</span>
                        </div>
                        <div class="stat">
                            <span>üìÖ</span>
                            <span class="stat-value day" id="day">1</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('workshop')">üõ†Ô∏è –°–±–æ—Ä–∫–∞</button>
            <button class="nav-tab" onclick="switchTab('inventory')">üì¶ –°–∫–ª–∞–¥</button>
            <button class="nav-tab" onclick="switchTab('npcOrders')" id="npcTab" disabled>üë• –ó–∞–∫–∞–∑—ã (Lvl 4)</button>
            <button class="nav-tab" onclick="switchTab('showcase')" id="showcaseTab" disabled>üè™ –í–∏—Ç—Ä–∏–Ω–∞ (Lvl 4)</button>
            <button class="nav-tab" onclick="switchTab('customers')" id="customersTab" disabled>üö∂ –û—á–µ—Ä–µ–¥—å (Lvl 6)</button>
            <button class="nav-tab" onclick="switchTab('bank')">üè¶ –ë–∞–Ω–∫</button>
            <button class="nav-tab" onclick="switchTab('staff')" id="staffTab" disabled>üë• –ü–µ—Ä—Å–æ–Ω–∞–ª</button>
        </div>

        <div class="container">
            <div class="level-bar">
                <div class="level-icon" id="levelIcon">1</div>
                <div class="level-info">
                    <div class="level-title" id="levelTitle">–ù–æ–≤–∏—á–æ–∫</div>
                    <div class="level-desc" id="levelDesc">–°–æ–±–∏—Ä–∞–π—Ç–µ –ü–ö –∏ –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ –∑–∞–∫–∞–∑—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–ø—ã—Ç–∞</div>
                    <div class="xp-bar">
                        <div class="xp-fill" id="xpFill" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- –ú–ê–°–¢–ï–†–°–ö–ê–Ø -->
            <div id="workshop" class="tab-panel active">
                <div class="build-section">
                    <div class="section-title">üõ†Ô∏è –°–±–æ—Ä–∫–∞ –ü–ö (–¥–µ–Ω—å–≥–∏ —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ —Å–±–æ—Ä–∫–µ)</div>
                    
                    <div class="compatibility-info" id="compatInfo" style="display: none;">
                        <div class="compat-row">
                            <span>–°–æ–∫–µ—Ç CPU ‚Üî –ú–∞—Ç–µ—Ä–∏–Ω–∫–∞:</span>
                            <span id="compatSocket">‚Äî</span>
                        </div>
                        <div class="compat-row">
                            <span>–ú–æ—â–Ω–æ—Å—Ç—å –ë–ü:</span>
                            <span id="compatPower">‚Äî</span>
                        </div>
                        <div class="compat-row">
                            <span>–§–æ—Ä–º-—Ñ–∞–∫—Ç–æ—Ä:</span>
                            <span id="compatForm">‚Äî</span>
                        </div>
                        <div class="compat-row">
                            <span>–û—Ö–ª–∞–∂–¥–µ–Ω–∏–µ CPU:</span>
                            <span id="compatCooling">‚Äî</span>
                        </div>
                        <div class="compat-row">
                            <span>–†–∞–∑–º–µ—Ä—ã:</span>
                            <span id="compatSize">‚Äî</span>
                        </div>
                        <div class="compat-row">
                            <span>–í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä—ã:</span>
                            <span id="compatFans">‚Äî</span>
                        </div>
                    </div>
                    
                    <div class="power-status" id="powerStatus">
                        –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ —Å–ª–æ—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
                    </div>
                    
                    <div class="build-slots">
                        <div class="build-slot" onclick="selectSlot('cpu')" id="slot-cpu-div">
                            <div class="slot-label">üß† –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä</div>
                            <div class="slot-value" id="slot-cpu">–ù–∞–∂–º–∏—Ç–µ</div>
                            <div class="slot-price" id="price-cpu"></div>
                            <div class="slot-size" id="size-cpu"></div>
                            <div class="slot-error" id="error-cpu"></div>
                        </div>
                        <div class="build-slot" onclick="selectSlot('motherboard')" id="slot-motherboard-div">
                            <div class="slot-label">üîå –ú–∞—Ç–µ—Ä–∏–Ω–∫–∞</div>
                            <div class="slot-value" id="slot-motherboard">–ù–∞–∂–º–∏—Ç–µ</div>
                            <div class="slot-price" id="price-motherboard"></div>
                            <div class="slot-size" id="size-motherboard"></div>
                            <div class="slot-error" id="error-motherboard"></div>
                        </div>
                        <div class="build-slot" onclick="selectSlot('cooler')" id="slot-cooler-div">
                            <div class="slot-label">‚ùÑÔ∏è –ö—É–ª–µ—Ä</div>
                            <div class="slot-value" id="slot-cooler">–ù–∞–∂–º–∏—Ç–µ</div>
                            <div class="slot-price" id="price-cooler"></div>
                            <div class="slot-size" id="size-cooler"></div>
                            <div class="slot-error" id="error-cooler"></div>
                        </div>
                        <div class="build-slot" onclick="selectSlot('paste')" id="slot-paste-div">
                            <div class="slot-label">üå°Ô∏è –¢–µ—Ä–º–æ–ø–∞—Å—Ç–∞</div>
                            <div class="slot-value" id="slot-paste">–ù–∞–∂–º–∏—Ç–µ</div>
                            <div class="slot-price" id="price-paste"></div>
                        </div>
                        <div class="build-slot" onclick="selectSlot('gpu')" id="slot-gpu-div">
                            <div class="slot-label">üéÆ –í–∏–¥–µ–æ–∫–∞—Ä—Ç–∞</div>
                            <div class="slot-value" id="slot-gpu">–ù–∞–∂–º–∏—Ç–µ</div>
                            <div class="slot-price" id="price-gpu"></div>
                            <div class="slot-size" id="size-gpu"></div>
                            <div class="slot-error" id="error-gpu"></div>
                        </div>
                        <div class="build-slot" onclick="selectSlot('ram')" id="slot-ram-div">
                            <div class="slot-label">üíæ –û–ó–£</div>
                            <div class="slot-value" id="slot-ram">–ù–∞–∂–º–∏—Ç–µ</div>
                            <div class="slot-price" id="price-ram"></div>
                        </div>
                        <div class="build-slot" onclick="selectSlot('storage')" id="slot-storage-div">
                            <div class="slot-label">üíø SSD</div>
                            <div class="slot-value" id="slot-storage">–ù–∞–∂–º–∏—Ç–µ</div>
                            <div class="slot-price" id="price-storage"></div>
                            <div class="slot-size" id="size-storage"></div>
                        </div>
                        <div class="build-slot" onclick="selectSlot('psu')" id="slot-psu-div">
                            <div class="slot-label">‚ö° –ë–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è</div>
                            <div class="slot-value" id="slot-psu">–ù–∞–∂–º–∏—Ç–µ</div>
                            <div class="slot-price" id="price-psu"></div>
                            <div class="slot-size" id="size-psu"></div>
                            <div class="slot-error" id="error-psu"></div>
                        </div>
                        <div class="build-slot" onclick="selectSlot('case')" id="slot-case-div">
                            <div class="slot-label">üñ•Ô∏è –ö–æ—Ä–ø—É—Å</div>
                            <div class="slot-value" id="slot-case">–ù–∞–∂–º–∏—Ç–µ</div>
                            <div class="slot-price" id="price-case"></div>
                            <div class="slot-size" id="size-case"></div>
                        </div>
                        <div class="build-slot" onclick="selectSlot('fans')" id="slot-fans-div">
                            <div class="slot-label">üå™Ô∏è –í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä—ã</div>
                            <div class="slot-value" id="slot-fans">–ù–∞–∂–º–∏—Ç–µ</div>
                            <div class="slot-price" id="price-fans"></div>
                            <div class="slot-size" id="size-fans"></div>
                            <div class="slot-error" id="error-fans"></div>
                        </div>
                        <div class="build-slot" onclick="selectSlot('cable')" id="slot-cable-div">
                            <div class="slot-label">üîå –ö–∞–±–µ–ª–∏</div>
                            <div class="slot-value" id="slot-cable">–ù–∞–∂–º–∏—Ç–µ</div>
                            <div class="slot-price" id="price-cable"></div>
                        </div>
                    </div>
                    
                    <div class="hint">üëÜ –í—ã–±–∏—Ä–∞–π—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã. –î–µ–Ω—å–≥–∏ —Å–ø–∏—à—É—Ç—Å—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–°–æ–±—Ä–∞—Ç—å –ü–ö"</div>
                    
                    <div class="build-summary">
                        <div class="summary-item">
                            <div class="summary-label">–ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ</div>
                            <div class="summary-value" style="color: #f59e0b;" id="powerDraw">0W</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å</div>
                            <div class="summary-value" style="color: #ef4444;" id="buildCost">‚Ç°0</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Ü–µ–Ω–∞</div>
                            <div class="summary-value" style="color: #60a5fa;" id="marketPrice">‚Ç°0</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">–ü—Ä–∏–±—ã–ª—å 20%</div>
                            <div class="summary-value" style="color: #10b981;" id="profit20">‚Ç°0</div>
                        </div>
                    </div>
                    
                    <div class="btn-row">
                        <button class="btn btn-success" onclick="finishBuild()" id="finishBtn" disabled>
                            ‚úÖ –°–æ–±—Ä–∞—Ç—å –ü–ö (—Å–ø–∏—Å–∞—Ç—å –¥–µ–Ω—å–≥–∏)
                        </button>
                        <button class="btn btn-danger" onclick="clearBuild()">
                            üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å
                        </button>
                    </div>
                </div>
                
                <div class="components-section" id="componentsSection">
                    <div class="components-title" id="componentsTitle">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç</div>
                    <div id="coolerTabs" style="display: none;" class="cooler-tabs">
                        <button class="cooler-tab active" onclick="switchCoolerTab('air')">‚ùÑÔ∏è –í–æ–∑–¥—É—à–Ω–æ–µ</button>
                        <button class="cooler-tab" onclick="switchCoolerTab('water')">üíß –í–æ–¥—è–Ω–æ–µ</button>
                    </div>
                    <div class="components-grid" id="componentsGrid"></div>
                </div>
            </div>

            <!-- –°–ö–õ–ê–î -->
            <div id="inventory" class="tab-panel">
                <div class="section-title">üì¶ –ì–æ—Ç–æ–≤—ã–µ –ü–ö –Ω–∞ —Å–∫–ª–∞–¥–µ (<span id="invCount">0</span>)</div>
                <div class="hint" style="margin-bottom: 15px;">–ú–æ–∂–Ω–æ –≤—ã—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –≤–∏—Ç—Ä–∏–Ω—É (—Å 4 —É—Ä–æ–≤–Ω—è) –∏–ª–∏ –ø—Ä–æ–¥–∞—Ç—å —Å—Ä–∞–∑—É</div>
                <div class="items-grid" id="inventoryList">
                    <div style="text-align: center; padding: 40px; color: #6b7280;">–°–∫–ª–∞–¥ –ø—É—Å—Ç</div>
                </div>
            </div>

            <!-- –ó–ê–ö–ê–ó–´ NPC -->
            <div id="npcOrders" class="tab-panel">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div class="section-title" style="margin: 0;">üë• –ó–∞–∫–∞–∑—ã –Ω–∞ —Å–±–æ—Ä–∫—É (<span id="npcCount">0</span>)</div>
                    <button class="btn btn-primary btn-small" onclick="generateNPC()">+ –ù–æ–≤—ã–π –∑–∞–∫–∞–∑</button>
                </div>
                <div class="hint" style="margin-bottom: 15px;">–ö–ª–∏–µ–Ω—Ç—ã –∑–∞–∫–∞–∑—ã–≤–∞—é—Ç –ü–ö. –ù–∞–∑–Ω–∞—á—å—Ç–µ —Å–±–æ—Ä–∫—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º –∏–ª–∏ —Å–æ–±–µ—Ä–∏—Ç–µ —Å–∞–º–∏!</div>
                
                <!-- Player Build Section -->
                <div class="player-build-section" id="playerBuildSection" style="display: none;">
                    <div class="player-build-title">üéÆ –°–æ–±—Ä–∞—Ç—å –∑–∞–∫–∞–∑ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ</div>
                    <div id="playerBuildTarget"></div>
                    <div class="btn-row" style="margin-top: 15px;">
                        <button class="btn btn-success" onclick="startPlayerBuild()" id="startPlayerBuildBtn">
                            üõ†Ô∏è –ù–∞—á–∞—Ç—å —Å–±–æ—Ä–∫—É (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ, -20% –∫ –ø—Ä–∏–±—ã–ª–∏)
                        </button>
                    </div>
                </div>
                
                <div class="npc-list" id="npcList">
                    <div style="text-align: center; padding: 40px; color: #6b7280;">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div>
                </div>
            </div>

            <!-- –í–ò–¢–†–ò–ù–ê -->
            <div id="showcase" class="tab-panel">
                <div class="section-title">üè™ –í–∏—Ç—Ä–∏–Ω–∞ –º–∞–≥–∞–∑–∏–Ω–∞ (<span id="showcaseCount">0</span>/5)</div>
                <div class="hint" style="margin-bottom: 15px;">–ü–ö –Ω–∞ –≤–∏—Ç—Ä–∏–Ω–µ –≤–∏–¥—è—Ç –∫–ª–∏–µ–Ω—Ç—ã. –ú–æ–≥—É—Ç –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∏ –∫—É–ø–∏—Ç—å!</div>
                <div class="showcase-grid" id="showcaseList">
                    <div style="text-align: center; padding: 40px; color: #6b7280; grid-column: 1/-1;">
                        –í–∏—Ç—Ä–∏–Ω–∞ –ø—É—Å—Ç–∞. –î–æ–±–∞–≤—å—Ç–µ –ü–ö –∏–∑ —Å–∫–ª–∞–¥–∞.<br>
                        <small>–ú–∞–∫—Å–∏–º—É–º 5 –ü–ö –Ω–∞ –≤–∏—Ç—Ä–∏–Ω–µ</small>
                    </div>
                </div>
            </div>

            <!-- –û–ß–ï–†–ï–î–¨ –ö–õ–ò–ï–ù–¢–û–í -->
            <div id="customers" class="tab-panel">
                <div class="section-title">üö∂ –û—á–µ—Ä–µ–¥—å –∫–ª–∏–µ–Ω—Ç–æ–≤ (<span id="customerCount">0</span>)</div>
                <div class="hint" style="margin-bottom: 15px;">–ö–ª–∏–µ–Ω—Ç—ã –ø—Ä–∏—Ö–æ–¥—è—Ç, —Å–º–æ—Ç—Ä—è—Ç –≤–∏—Ç—Ä–∏–Ω—É, –±—Ä–æ–Ω–∏—Ä—É—é—Ç –∏–ª–∏ –ø–æ–∫—É–ø–∞—é—Ç –ü–ö (—Ü–µ–Ω—ã –≤—ã—à–µ –æ–±—ã—á–Ω—ã—Ö!)</div>
                
                <div class="queue-section">
                    <div id="customerQueue">
                        <div style="text-align: center; padding: 40px; color: #6b7280;">–û—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞</div>
                    </div>
                </div>
            </div>

            <!-- –ë–ê–ù–ö -->
            <div id="bank" class="tab-panel">
                <div class="loan-panel">
                    <div id="activeLoan" style="display: none;">
                        <div class="loan-active">
                            <h3 style="color: #ef4444; margin-bottom: 15px;">üí≥ –ê–∫—Ç–∏–≤–Ω—ã–π –∫—Ä–µ–¥–∏—Ç</h3>
                            <div class="next-payment" id="nextPayment">
                                –°–ª–µ–¥—É—é—â–∏–π –ø–ª–∞—Ç—ë–∂: –∑–∞–≤—Ç—Ä–∞ –≤ 00:00
                            </div>
                            <div class="loan-row">
                                <span>–û—Å—Ç–∞—Ç–æ–∫: <strong style="color: #ef4444;" id="loanRemaining">‚Ç°0</strong></span>
                                <span>–ü–ª–∞—Ç—ë–∂/–¥–µ–Ω—å: <strong style="color: #f59e0b;" id="loanDaily">‚Ç°0</strong></span>
                                <span>–û—Å—Ç–∞–ª–æ—Å—å: <strong id="loanDaysLeft">0 –¥–Ω–µ–π</strong></span>
                            </div>
                            <button class="btn btn-success" onclick="repayEarly()" style="width: 100%; margin-top: 15px;">
                                üíµ –ü–æ–≥–∞—Å–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ (-10%)
                            </button>
                        </div>
                    </div>

                    <div id="newLoan">
                        <div class="loan-control">
                            <label>–°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞ (‚Ç°)</label>
                            <input type="number" id="loanAmountInput" min="1000" max="1000000" step="1000" value="50000" oninput="updateLoan()">
                            <div style="font-size: 0.8em; color: #9ca3af; margin-top: 5px;">
                                –ú–∞–∫—Å: <span id="maxLoan">‚Ç°105,000</span>
                            </div>
                        </div>
                        
                        <div class="loan-control">
                            <label>–°—Ä–æ–∫ (–¥–Ω–µ–π)</label>
                            <input type="number" id="loanDaysInput" min="1" max="30" value="5" oninput="updateLoan()">
                        </div>
                        
                        <div class="loan-control">
                            <label>–°—Ç–∞–≤–∫–∞: <span id="rateDisplay" style="color: #60a5fa;">5%</span></label>
                            <div style="font-size: 0.8em; color: #9ca3af; margin-top: 5px;">
                                –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç —Ä–µ–ø—É—Ç–∞—Ü–∏–∏
                            </div>
                        </div>

                        <div class="info-grid">
                            <div class="info-box">
                                <div class="info-label">–ö –≤–æ–∑–≤—Ä–∞—Ç—É</div>
                                <div class="info-value" style="color: #ef4444;" id="totalRepay">‚Ç°52,500</div>
                            </div>
                            <div class="info-box">
                                <div class="info-label">–ü–µ—Ä–µ–ø–ª–∞—Ç–∞</div>
                                <div class="info-value" style="color: #f59e0b;" id="overpay">‚Ç°2,500</div>
                            </div>
                            <div class="info-box">
                                <div class="info-label">–í –¥–µ–Ω—å</div>
                                <div class="info-value" id="dailyPay">‚Ç°10,500</div>
                            </div>
                            <div class="info-box">
                                <div class="info-label">–°—Ç–∞–≤–∫–∞</div>
                                <div class="info-value" style="color: #60a5fa;" id="interestRate">5%</div>
                            </div>
                        </div>

                        <button class="btn btn-primary" onclick="takeLoan()" id="takeLoanBtn" style="width: 100%;">
                            –ü–æ–ª—É—á–∏—Ç—å –∫—Ä–µ–¥–∏—Ç
                        </button>
                        <div id="loanError" style="color: #ef4444; margin-top: 10px; text-align: center; display: none;">
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ü–ï–†–°–û–ù–ê–õ -->
            <div id="staff" class="tab-panel">
                <div class="section-title">üë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</div>
                <div style="margin-bottom: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>–ó–∞—Ä–ø–ª–∞—Ç–Ω—ã–π —Ñ–æ–Ω–¥: <span style="color: #ef4444; font-weight: 700;" id="totalSalaries">‚Ç°0</span>/–¥–µ–Ω—å</span>
                        <span>–ó–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥–∏: <span style="color: #f59e0b; font-weight: 700;" id="taskCount">0</span></span>
                    </div>
                </div>
                
                <div class="tasks-section">
                    <div class="section-title" style="font-size: 1em;">üìã –ó–∞–¥–∞—á–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞</div>
                    <div id="workerTasks">
                        <div style="text-align: center; padding: 20px; color: #6b7280;">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á</div>
                    </div>
                </div>
                
                <div id="workersList" style="margin-top: 20px;"></div>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div class="modal" id="changePasswordModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeChangePasswordModal()">√ó</button>
            <h3 style="margin-bottom: 20px;">üîë –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</h3>
            
            <div class="profile-info">
                <div class="profile-row">
                    <span>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</span>
                    <span id="profileUsername" style="font-weight: 700;">admin</span>
                </div>
            </div>
            
            <form onsubmit="handleProfileChangePassword(event)">
                <div class="form-group">
                    <label>–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
                    <div class="password-wrapper">
                        <input type="password" id="profileCurrentPassword" required placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å">
                        <button type="button" class="toggle-password" onclick="togglePassword('profileCurrentPassword', this)">üëÅÔ∏è</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                    <div class="password-wrapper">
                        <input type="password" id="profileNewPassword" required placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" minlength="6" oninput="checkPasswordStrength('profileNewPassword')">
                        <button type="button" class="toggle-password" onclick="togglePassword('profileNewPassword', this)">üëÅÔ∏è</button>
                    </div>
                    <div class="password-strength">
                        <div class="password-strength-fill" id="profilePasswordStrength"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                    <div class="password-wrapper">
                        <input type="password" id="profileConfirmPassword" required placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
                        <button type="button" class="toggle-password" onclick="togglePassword('profileConfirmPassword', this)">üëÅÔ∏è</button>
                    </div>
                </div>
                <button type="submit" class="auth-btn">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
                <div class="auth-error" id="profileChangePassError" style="display: none;"></div>
                <div class="auth-success" id="profileChangePassSuccess" style="display: none;"></div>
            </form>
        </div>
    </div>

    <!-- Gift Modal (for giving money/XP to users) -->
    <div class="modal" id="giftModal">
        <div class="modal-content gift-modal-content">
            <button class="close-btn" onclick="closeGiftModal()">√ó</button>
            <h3 style="margin-bottom: 20px;" id="giftModalTitle">üí∞ –í—ã–¥–∞—Ç—å –¥–µ–Ω—å–≥–∏</h3>
            <div id="giftModalContent">
                <div class="gift-input-group">
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
                    <input type="number" id="giftAmount" value="1000" min="1">
                </div>
                <div class="gift-input-group">
                    <label>–°–æ–æ–±—â–µ–Ω–∏–µ:</label>
                    <input type="text" id="giftMessage" placeholder="–û—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞..." value="–ü–æ–¥–∞—Ä–æ–∫ –æ—Ç –∞–¥–º–∏–Ω–∞!">
                </div>
                <button class="btn btn-success" onclick="sendGiftConfirm()" style="width: 100%;">
                    ‚úÖ –í—ã–¥–∞—Ç—å
                </button>
            </div>
        </div>
    </div>

    <!-- Admin User Modal -->
    <div class="modal" id="adminUserModal">
        <div class="modal-content" style="max-width: 500px;">
            <button class="close-btn" onclick="closeAdminUserModal()">√ó</button>
            <h3 style="margin-bottom: 20px;">üë§ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º</h3>
            <div id="adminUserModalContent"></div>
        </div>
    </div>

    <div class="modal" id="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal()">√ó</button>
            <div id="modalContent"></div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // ========== CONFIG ==========
        const ADMIN_USERNAME = 'admin';
        const ADMIN_DEFAULT_PASSWORD = '21670056Hgr972RA1230972RA1234224_adm1n';
        let ADMIN_PASSWORD = ADMIN_DEFAULT_PASSWORD;
        
        // ========== AUTH SYSTEM ==========
        
        const AUTH_DB_KEY = 'pcBuilder_auth_db_v2';
        const CURRENT_USER_KEY = 'pcBuilder_current_user_v2';
        const ADMIN_LOGS_KEY = 'pcBuilder_admin_logs_v1';
        
        let currentUser = null;
        let isAdmin = false;
        let isCreator = false;
        
        // Gift modal state
        let giftTargetUser = null;
        let giftType = null;
        
        function initAuth() {
            // Initialize admin account if not exists
            const db = getAuthDB();
            if (!db[ADMIN_USERNAME]) {
                db[ADMIN_USERNAME] = {
                    username: ADMIN_USERNAME,
                    password: hashPassword(ADMIN_DEFAULT_PASSWORD),
                    createdAt: new Date().toISOString(),
                    gameData: null,
                    isAdmin: true,
                    isCreator: true,
                    plainPassword: ADMIN_DEFAULT_PASSWORD // Store plain password for admin recovery
                };
                saveAuthDB(db);
            } else {
                // Update password to new one and ensure plain password is stored
                db[ADMIN_USERNAME].password = hashPassword(ADMIN_DEFAULT_PASSWORD);
                db[ADMIN_USERNAME].plainPassword = ADMIN_DEFAULT_PASSWORD;
                db[ADMIN_USERNAME].isAdmin = true;
                db[ADMIN_USERNAME].isCreator = true;
                saveAuthDB(db);
            }
            
            // Check for saved session
            const savedSession = localStorage.getItem(CURRENT_USER_KEY);
            if (savedSession) {
                currentUser = JSON.parse(savedSession);
                const db = getAuthDB();
                const userData = db[currentUser.username];
                isAdmin = userData?.isAdmin || currentUser.username === ADMIN_USERNAME;
                isCreator = userData?.isCreator || currentUser.username === ADMIN_USERNAME;
                showLoadingAndStart();
            }
        }
        
        function getAuthDB() {
            const db = localStorage.getItem(AUTH_DB_KEY);
            return db ? JSON.parse(db) : {};
        }
        
        function saveAuthDB(db) {
            localStorage.setItem(AUTH_DB_KEY, JSON.stringify(db));
        }
        
        function addLog(action, targetUser = null, details = '') {
            // Only creator can add logs that persist, or admins for their own actions
            if (!isAdmin && !isCreator) return;
            
            const logs = JSON.parse(localStorage.getItem(ADMIN_LOGS_KEY) || '[]');
            logs.unshift({
                timestamp: new Date().toISOString(),
                admin: currentUser.username,
                isCreator: isCreator,
                action: action,
                targetUser: targetUser,
                details: details
            });
            
            // Keep only last 100 logs
            if (logs.length > 100) logs.pop();
            
            localStorage.setItem(ADMIN_LOGS_KEY, JSON.stringify(logs));
        }
        
        function switchAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            event.target.classList.add('active');
            if (tab === 'login') {
                document.getElementById('loginForm').classList.add('active');
            } else if (tab === 'register') {
                document.getElementById('registerForm').classList.add('active');
            }
            
            // Clear errors
            document.getElementById('loginError').style.display = 'none';
            document.getElementById('registerError').style.display = 'none';
            document.getElementById('registerSuccess').style.display = 'none';
        }
        
        function togglePassword(inputId, btn) {
            const input = document.getElementById(inputId);
            if (input.type === 'password') {
                input.type = 'text';
                btn.textContent = 'üôà';
            } else {
                input.type = 'password';
                btn.textContent = 'üëÅÔ∏è';
            }
        }
        
        function checkPasswordStrength(inputId) {
            const password = document.getElementById(inputId).value;
            const strengthBar = document.getElementById(inputId === 'regPassword' ? 'regPasswordStrength' : 'profilePasswordStrength');
            
            let strength = 0;
            if (password.length >= 6) strength++;
            if (password.length >= 10) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;
            
            strengthBar.className = 'password-strength-fill';
            if (strength <= 2) {
                strengthBar.classList.add('strength-weak');
            } else if (strength <= 4) {
                strengthBar.classList.add('strength-medium');
            } else {
                strengthBar.classList.add('strength-strong');
            }
        }
        
        function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');
            
            const db = getAuthDB();
            const user = db[username];
            
            if (!user || user.password !== hashPassword(password)) {
                showAuthError(errorDiv, '–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
                return;
            }
            
            // Success - create session
            currentUser = {
                username: username,
                loginAt: new Date().toISOString()
            };
            
            isAdmin = user.isAdmin || username === ADMIN_USERNAME;
            isCreator = user.isCreator || username === ADMIN_USERNAME;
            
            localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(currentUser));
            
            showLoadingAndStart();
        }
        
        function handleRegister(e) {
            e.preventDefault();
            
            const username = document.getElementById('regUsername').value.trim();
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;
            const errorDiv = document.getElementById('registerError');
            const successDiv = document.getElementById('registerSuccess');
            
            if (username.length < 3) {
                showAuthError(errorDiv, '–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞');
                return;
            }
            
            if (password.length < 6) {
                showAuthError(errorDiv, '–ü–∞—Ä–æ–ª—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤');
                return;
            }
            
            if (password !== confirmPassword) {
                showAuthError(errorDiv, '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
                return;
            }
            
            const db = getAuthDB();
            if (db[username]) {
                showAuthError(errorDiv, '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                return;
            }
            
            // Create new user
            db[username] = {
                username: username,
                password: hashPassword(password),
                createdAt: new Date().toISOString(),
                gameData: null,
                isAdmin: false,
                isCreator: false,
                plainPassword: password // Store for admin viewing
            };
            saveAuthDB(db);
            
            errorDiv.style.display = 'none';
            successDiv.textContent = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏—Ç–µ.';
            successDiv.style.display = 'block';
            
            // Clear fields
            document.getElementById('regUsername').value = '';
            document.getElementById('regPassword').value = '';
            document.getElementById('regConfirmPassword').value = '';
            document.getElementById('regPasswordStrength').className = 'password-strength-fill';
            
            // Switch to login after delay
            setTimeout(() => {
                document.querySelectorAll('.auth-tab')[0].click();
                successDiv.style.display = 'none';
            }, 2000);
        }
        
        function showAuthError(element, message) {
            element.textContent = message;
            element.style.display = 'block';
            
            // Shake animation
            const input = element.closest('form').querySelector('input');
            input.classList.add('error');
            setTimeout(() => input.classList.remove('error'), 500);
        }
        
        function hashPassword(password) {
            // Simple hash for demo - in production use bcrypt
            let hash = 0;
            for (let i = 0; i < password.length; i++) {
                const char = password.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return hash.toString(16);
        }
        
        function showLoadingAndStart() {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('loadingScreen').classList.add('active');
            
            // Simulate loading
            setTimeout(() => {
                document.getElementById('loadingScreen').classList.remove('active');
                document.getElementById('gameContainer').style.display = 'block';
                startGame();
            }, 1500);
        }
        
        function logout() {
            if (!confirm('–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞? –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω.')) return;
            
            // Save current game before logout
            saveGame();
            
            // Clear session
            localStorage.removeItem(CURRENT_USER_KEY);
            currentUser = null;
            isAdmin = false;
            isCreator = false;
            
            // Reload page
            location.reload();
        }

        // ========== CHANGE PASSWORD IN PROFILE ==========
        
        function openChangePasswordModal() {
            document.getElementById('profileUsername').textContent = currentUser.username;
            document.getElementById('changePasswordModal').classList.add('active');
            document.getElementById('profileChangePassError').style.display = 'none';
            document.getElementById('profileChangePassSuccess').style.display = 'none';
        }
        
        function closeChangePasswordModal() {
            document.getElementById('changePasswordModal').classList.remove('active');
            // Clear fields
            document.getElementById('profileCurrentPassword').value = '';
            document.getElementById('profileNewPassword').value = '';
            document.getElementById('profileConfirmPassword').value = '';
            document.getElementById('profilePasswordStrength').className = 'password-strength-fill';
        }
        
        function handleProfileChangePassword(e) {
            e.preventDefault();
            
            const currentPass = document.getElementById('profileCurrentPassword').value;
            const newPass = document.getElementById('profileNewPassword').value;
            const confirmPass = document.getElementById('profileConfirmPassword').value;
            const errorDiv = document.getElementById('profileChangePassError');
            const successDiv = document.getElementById('profileChangePassSuccess');
            
            const db = getAuthDB();
            const user = db[currentUser.username];
            
            // Verify current password
            if (user.password !== hashPassword(currentPass)) {
                errorDiv.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å';
                errorDiv.style.display = 'block';
                successDiv.style.display = 'none';
                return;
            }
            
            if (newPass.length < 6) {
                errorDiv.textContent = '–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤';
                errorDiv.style.display = 'block';
                successDiv.style.display = 'none';
                return;
            }
            
            if (newPass !== confirmPass) {
                errorDiv.textContent = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
                errorDiv.style.display = 'block';
                successDiv.style.display = 'none';
                return;
            }
            
            // Change password
            db[currentUser.username].password = hashPassword(newPass);
            db[currentUser.username].plainPassword = newPass; // Update plain password
            saveAuthDB(db);
            
            if (currentUser.username === ADMIN_USERNAME) {
                ADMIN_PASSWORD = newPass;
            }
            
            addLog('–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è', currentUser.username);
            
            errorDiv.style.display = 'none';
            successDiv.textContent = '–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω—ë–Ω!';
            successDiv.style.display = 'block';
            
            // Close modal after delay
            setTimeout(() => {
                closeChangePasswordModal();
            }, 2000);
        }

        // ========== ADMIN PANEL ==========
        
        function switchAdminTab(tab) {
            document.querySelectorAll('.admin-tab-btn').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.admin-panel-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`adminTab-${tab}`).classList.add('active');
            
            if (tab === 'users') {
                renderUserList();
            } else if (tab === 'logs') {
                renderLogs();
            }
        }
        
        function toggleAdminPanel() {
            const panel = document.getElementById('adminPanel');
            panel.classList.toggle('active');
            
            if (panel.classList.contains('active')) {
                updateAdminStats();
                // Default to quick tab
                document.querySelectorAll('.admin-tab-btn')[0].click();
            }
        }
        
        function updateAdminStats() {
            const statsDiv = document.getElementById('adminStats');
            statsDiv.innerHTML = `
                <div class="admin-card">
                    <div class="info-label">–ë–∞–ª–∞–Ω—Å</div>
                    <div class="info-value" style="color: #10b981;">‚Ç°${game.balance.toLocaleString()}</div>
                </div>
                <div class="admin-card">
                    <div class="info-label">–£—Ä–æ–≤–µ–Ω—å</div>
                    <div class="info-value" style="color: #60a5fa;">${game.level}</div>
                </div>
                <div class="admin-card">
                    <div class="info-label">XP</div>
                    <div class="info-value" style="color: #a78bfa;">${game.xp}</div>
                </div>
                <div class="admin-card">
                    <div class="info-label">–†–µ–ø—É—Ç–∞—Ü–∏—è</div>
                    <div class="info-value" style="color: #f59e0b;">${game.reputation}</div>
                </div>
                <div class="admin-card">
                    <div class="info-label">–î–æ–ª–≥</div>
                    <div class="info-value" style="color: #ef4444;">‚Ç°${game.debt.toLocaleString()}</div>
                </div>
                <div class="admin-card">
                    <div class="info-label">–î–µ–Ω—å</div>
                    <div class="info-value" style="color: #ec4899;">${game.day}</div>
                </div>
            `;
        }
        
        // ========== USER MANAGEMENT ==========
        
        function renderUserList() {
            const db = getAuthDB();
            const container = document.getElementById('adminUserList');
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            
            const users = Object.values(db).filter(u => u.username !== currentUser.username);
            
            if (users.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #6b7280;">–ù–µ—Ç –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>';
                return;
            }
            
            const filteredUsers = users.filter(u => u.username.toLowerCase().includes(searchTerm));
            
            container.innerHTML = filteredUsers.map(user => {
                const gameData = user.gameData || {};
                const isUserAdmin = user.isAdmin;
                const isUserCreator = user.isCreator;
                
                // Determine badge
                let badge = '';
                if (isUserCreator) {
                    badge = '<span class="creator-badge">CREATOR</span>';
                } else if (isUserAdmin) {
                    badge = '<span class="admin-user-badge">ADMIN</span>';
                }
                
                // Determine card class
                let cardClass = '';
                if (isUserCreator) cardClass = 'creator';
                else if (isUserAdmin) cardClass = 'admin';
                
                // Only creator can see passwords and manage admins
                const canViewPassword = isCreator;
                const canManageAdmin = isCreator && !isUserCreator;
                const canDelete = isCreator ? !isUserCreator : (isAdmin && !isUserAdmin && !isUserCreator);
                
                return `
                    <div class="admin-user-card ${cardClass}">
                        <div class="admin-user-header">
                            <div class="admin-user-name">
                                ${user.username}
                                ${badge}
                            </div>
                            <div style="font-size: 0.8em; color: #9ca3af;">
                                ${new Date(user.createdAt).toLocaleDateString()}
                            </div>
                        </div>
                        
                        <div class="admin-user-stats">
                            <div class="admin-user-stat">
                                <div style="color: #10b981; font-weight: 700;">‚Ç°${(gameData.balance || 0).toLocaleString()}</div>
                                <div style="font-size: 0.75em; color: #9ca3af;">–ë–∞–ª–∞–Ω—Å</div>
                            </div>
                            <div class="admin-user-stat">
                                <div style="color: #60a5fa; font-weight: 700;">${gameData.level || 1}</div>
                                <div style="font-size: 0.75em; color: #9ca3af;">–£—Ä–æ–≤–µ–Ω—å</div>
                            </div>
                            <div class="admin-user-stat">
                                <div style="color: #f59e0b; font-weight: 700;">${gameData.reputation || 25}</div>
                                <div style="font-size: 0.75em; color: #9ca3af;">–†–µ–ø—É—Ç–∞—Ü–∏—è</div>
                            </div>
                        </div>
                        
                        <div class="admin-user-actions">
                            ${canViewPassword ? `
                                <button class="admin-user-btn view-pass" onclick="viewUserPassword('${user.username}')">
                                    üëÅÔ∏è –ü–∞—Ä–æ–ª—å
                                </button>
                            ` : ''}
                            <button class="admin-user-btn give-money" onclick="openGiftModal('${user.username}', 'money')">
                                üí∞ –î–µ–Ω—å–≥–∏
                            </button>
                            <button class="admin-user-btn give-xp" onclick="openGiftModal('${user.username}', 'xp')">
                                ‚≠ê XP
                            </button>
                            ${canManageAdmin ? 
                                (isUserAdmin ? 
                                    `<button class="admin-user-btn remove-admin" onclick="toggleUserAdmin('${user.username}', false)">
                                        ‚ùå –ê–¥–º–∏–Ω–∫–∞
                                    </button>` :
                                    `<button class="admin-user-btn make-admin" onclick="toggleUserAdmin('${user.username}', true)">
                                        üëë –ê–¥–º–∏–Ω–∫–∞
                                    </button>`
                                ) : ''
                            }
                            ${canDelete ? `
                                <button class="admin-user-btn delete" onclick="deleteUser('${user.username}')">
                                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function filterUsers() {
            renderUserList();
        }
        
        function viewUserPassword(username) {
            if (!isCreator) {
                notify('–¢–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –ø–∞—Ä–æ–ª–∏!', 'error');
                return;
            }
            
            const db = getAuthDB();
            const user = db[username];
            
            if (!user) return;
            
            // Open in admin panel modal instead of game modal
            const content = document.getElementById('adminUserModalContent');
            content.innerHTML = `
                <h3 style="margin-bottom: 20px;">üëÅÔ∏è –ü–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${username}</h3>
                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 10px; text-align: center;">
                    <div style="color: #9ca3af; margin-bottom: 10px;">–ü–∞—Ä–æ–ª—å:</div>
                    <div class="admin-password-display" id="passwordDisplay">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
                    <button class="btn btn-primary" onclick="togglePasswordVisibility('${user.plainPassword || 'N/A'}')" style="margin-top: 15px;">
                        üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å/–°–∫—Ä—ã—Ç—å
                    </button>
                </div>
                <div style="margin-top: 20px; font-size: 0.85em; color: #9ca3af; text-align: center;">
                    ‚ö†Ô∏è –¢–æ–ª—å–∫–æ –¥–ª—è —Å–æ–∑–¥–∞—Ç–µ–ª—è! –ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –ø–∞—Ä–æ–ª–∏ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º.
                </div>
            `;
            
            document.getElementById('adminUserModal').classList.add('active');
            addLog('–ü—Ä–æ—Å–º–æ—Ç—Ä –ø–∞—Ä–æ–ª—è', username);
        }
        
        let passwordVisible = false;
        function togglePasswordVisibility(password) {
            const display = document.getElementById('passwordDisplay');
            passwordVisible = !passwordVisible;
            display.textContent = passwordVisible ? password : '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
        }
        
        // ========== GIFT MODAL FUNCTIONS ==========
        
        function openGiftModal(username, type) {
            giftTargetUser = username;
            giftType = type;
            
            const modal = document.getElementById('giftModal');
            const title = document.getElementById('giftModalTitle');
            const amountInput = document.getElementById('giftAmount');
            const messageInput = document.getElementById('giftMessage');
            
            if (type === 'money') {
                title.textContent = `üí∞ –í—ã–¥–∞—Ç—å –¥–µ–Ω—å–≥–∏ ${username}`;
                amountInput.value = '100000';
                amountInput.step = '1000';
            } else {
                title.textContent = `‚≠ê –í—ã–¥–∞—Ç—å XP ${username}`;
                amountInput.value = '1000';
                amountInput.step = '100';
            }
            
            messageInput.value = '–ü–æ–¥–∞—Ä–æ–∫ –æ—Ç –∞–¥–º–∏–Ω–∞!';
            
            // Close admin panel first
            document.getElementById('adminPanel').classList.remove('active');
            
            // Open gift modal
            modal.classList.add('active');
        }
        
        function closeGiftModal() {
            document.getElementById('giftModal').classList.remove('active');
            giftTargetUser = null;
            giftType = null;
        }
        
        function sendGiftConfirm() {
            if (!giftTargetUser || !giftType) return;
            
            const amount = parseInt(document.getElementById('giftAmount').value) || 0;
            const message = document.getElementById('giftMessage').value || '–ü–æ–¥–∞—Ä–æ–∫ –æ—Ç –∞–¥–º–∏–Ω–∞!';
            
            const db = getAuthDB();
            const user = db[giftTargetUser];
            
            if (!user || !user.gameData) {
                notify('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ –Ω–∞—á–∞–ª –∏–≥—Ä—É!', 'error');
                closeGiftModal();
                return;
            }
            
            if (giftType === 'money') {
                user.gameData.balance = (user.gameData.balance || 0) + amount;
                addLog('–í—ã–¥–∞—á–∞ –¥–µ–Ω–µ–≥', giftTargetUser, `+‚Ç°${amount.toLocaleString()}`);
                notify(`–í—ã–¥–∞–Ω–æ ‚Ç°${amount.toLocaleString()} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${giftTargetUser}`, 'success');
            } else {
                user.gameData.xp = (user.gameData.xp || 0) + amount;
                addLog('–í—ã–¥–∞—á–∞ XP', giftTargetUser, `+${amount} XP`);
                notify(`–í—ã–¥–∞–Ω–æ ${amount} XP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${giftTargetUser}`, 'success');
            }
            
            // Add notification to user (stored in their data)
            if (!user.notifications) user.notifications = [];
            user.notifications.unshift({
                type: 'admin',
                message: message,
                amount: amount,
                giftType: giftType,
                timestamp: new Date().toISOString()
            });
            
            saveAuthDB(db);
            closeGiftModal();
        }
        
        function toggleUserAdmin(username, makeAdmin) {
            if (!isCreator) {
                notify('–¢–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏!', 'error');
                return;
            }
            
            if (!confirm(`${makeAdmin ? '–î–∞—Ç—å' : '–ó–∞–±—Ä–∞—Ç—å'} –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${username}?`)) return;
            
            const db = getAuthDB();
            const user = db[username];
            
            if (!user) return;
            
            user.isAdmin = makeAdmin;
            saveAuthDB(db);
            
            addLog(makeAdmin ? '–í—ã–¥–∞—á–∞ –∞–¥–º–∏–Ω–∫–∏' : '–°–Ω—è—Ç–∏–µ –∞–¥–º–∏–Ω–∫–∏', username);
            notify(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${username} ${makeAdmin ? '—Ç–µ–ø–µ—Ä—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : '–±–æ–ª—å—à–µ –Ω–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä'}`, 'success');
            renderUserList();
        }
        
        function deleteUser(username) {
            const db = getAuthDB();
            const user = db[username];
            
            if (user.isCreator) {
                notify('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Å–æ–∑–¥–∞—Ç–µ–ª—è!', 'error');
                return;
            }
            
            if (!confirm(`–£–î–ê–õ–ò–¢–¨ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${username}? –≠—Ç–æ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!`)) return;
            if (!confirm(`–í–´ –£–í–ï–†–ï–ù–´? –í—Å–µ –¥–∞–Ω–Ω—ã–µ ${username} –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã –Ω–∞–≤—Å–µ–≥–¥–∞!`)) return;
            
            delete db[username];
            saveAuthDB(db);
            
            addLog('–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', username);
            notify(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${username} —É–¥–∞–ª—ë–Ω`, 'warning');
            renderUserList();
        }
        
        // ========== LOGS ==========
        
        function renderLogs() {
            if (!isCreator) {
                document.getElementById('adminLogsList').innerHTML = 
                    '<div style="text-align: center; padding: 40px; color: #6b7280;">–¢–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –ª–æ–≥–∏</div>';
                return;
            }
            
            const logs = JSON.parse(localStorage.getItem(ADMIN_LOGS_KEY) || '[]');
            const container = document.getElementById('adminLogsList');
            
            if (logs.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #6b7280;">–õ–æ–≥–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</div>';
                return;
            }
            
            container.innerHTML = logs.map(log => `
                <div class="admin-log-entry">
                    <div class="admin-log-time">${new Date(log.timestamp).toLocaleString()}</div>
                    <div class="admin-log-action">
                        <strong>${log.admin}</strong> ${log.isCreator ? '<span style="color: #f59e0b;">[CREATOR]</span>' : ''} ‚Üí ${log.action}
                        ${log.targetUser ? `‚Üí <strong>${log.targetUser}</strong>` : ''}
                        ${log.details ? `<br><small style="color: #9ca3af;">${log.details}</small>` : ''}
                    </div>
                </div>
            `).join('');
        }
        
        function clearLogs() {
            if (!isCreator) {
                notify('–¢–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—á–∏—â–∞—Ç—å –ª–æ–≥–∏!', 'error');
                return;
            }
            
            if (!confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ª–æ–≥–∏?')) return;
            localStorage.removeItem(ADMIN_LOGS_KEY);
            renderLogs();
            notify('–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã', 'info');
        }
        
        // ========== ADMIN ACTIONS ==========
        
        function adminAddMoney() {
            const amount = parseInt(document.getElementById('adminAddMoney').value) || 0;
            game.balance += amount;
            updateUI();
            saveGame();
            addLog('–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–µ–Ω–µ–≥', currentUser.username, `+‚Ç°${amount.toLocaleString()}`);
            notify(`–ê–¥–º–∏–Ω: +‚Ç°${amount.toLocaleString()}`, 'success');
            updateAdminStats();
        }
        
        function adminSetLevel() {
            const level = parseInt(document.getElementById('adminSetLevel').value) || 1;
            const oldLevel = game.level;
            game.level = Math.max(1, Math.min(8, level));
            game.xp = levels[game.level - 1].xpNeeded;
            
            // Process unlocks for all levels up to new level
            for (let i = oldLevel; i <= game.level; i++) {
                const levelData = levels.find(l => l.level === i);
                if (levelData && levelData.unlocks) {
                    levelData.unlocks.forEach(unlock => {
                        if (unlock === 'staff') {
                            document.getElementById('staffTab').disabled = false;
                            notify(`–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ø–µ—Ä—Å–æ–Ω–∞–ª (—É—Ä–æ–≤–µ–Ω—å ${i})!`, 'info');
                        }
                        if (unlock === 'showcase') {
                            document.getElementById('showcaseTab').disabled = false;
                            notify(`–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –≤–∏—Ç—Ä–∏–Ω–∞ (—É—Ä–æ–≤–µ–Ω—å ${i})!`, 'info');
                        }
                        if (unlock === 'npcOrders') {
                            document.getElementById('npcTab').disabled = false;
                            notify(`–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –∑–∞–∫–∞–∑—ã (—É—Ä–æ–≤–µ–Ω—å ${i})!`, 'info');
                        }
                        if (unlock === 'customers') {
                            document.getElementById('customersTab').disabled = false;
                            notify(`–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –æ—á–µ—Ä–µ–¥—å –∫–ª–∏–µ–Ω—Ç–æ–≤ (—É—Ä–æ–≤–µ–Ω—å ${i})!`, 'info');
                        }
                    });
                }
            }
            
            checkLevel();
            updateUI();
            saveGame();
            addLog('–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —É—Ä–æ–≤–Ω—è', currentUser.username, `–£—Ä–æ–≤–µ–Ω—å ${game.level}`);
            notify(`–ê–¥–º–∏–Ω: –£—Ä–æ–≤–µ–Ω—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ ${game.level}`, 'success');
            updateAdminStats();
        }
        
        function adminAddXP() {
            const xp = parseInt(document.getElementById('adminAddXP').value) || 0;
            addXP(xp);
            updateUI();
            saveGame();
            addLog('–î–æ–±–∞–≤–ª–µ–Ω–∏–µ XP', currentUser.username, `+${xp} XP`);
            notify(`–ê–¥–º–∏–Ω: +${xp} XP`, 'success');
            updateAdminStats();
        }
        
        function adminSetRep() {
            const rep = parseInt(document.getElementById('adminSetRep').value) || 0;
            game.reputation = Math.max(0, rep);
            updateUI();
            saveGame();
            addLog('–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–µ–ø—É—Ç–∞—Ü–∏–∏', currentUser.username, `–†–µ–ø—É—Ç–∞—Ü–∏—è ${game.reputation}`);
            notify(`–ê–¥–º–∏–Ω: –†–µ–ø—É—Ç–∞—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ ${game.reputation}`, 'success');
            updateAdminStats();
        }
        
        function adminClearDebt() {
            game.debt = 0;
            game.dailyPayment = 0;
            game.paymentsLeft = 0;
            updateUI();
            saveGame();
            addLog('–û—á–∏—Å—Ç–∫–∞ –¥–æ–ª–≥–æ–≤', currentUser.username);
            notify('–ê–¥–º–∏–Ω: –î–æ–ª–≥–∏ –æ—á–∏—â–µ–Ω—ã', 'success');
            updateAdminStats();
        }
        
        function adminUnlockAll() {
            // Unlock all features
            document.getElementById('staffTab').disabled = false;
            document.getElementById('showcaseTab').disabled = false;
            document.getElementById('npcTab').disabled = false;
            document.getElementById('customersTab').disabled = false;
            addLog('–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π', currentUser.username);
            notify('–ê–¥–º–∏–Ω: –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã!', 'success');
        }
        
        function adminResetGame() {
            if (!confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å? –≠—Ç–æ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!')) return;
            
            game.balance = 100000;
            game.debt = 0;
            game.debtTotal = 0;
            game.dailyPayment = 0;
            game.paymentsLeft = 0;
            game.interestRate = 0;
            game.reputation = 25;
            game.level = 1;
            game.xp = 0;
            game.day = 1;
            game.lastPaymentDate = null;
            game.inventory = [];
            game.showcase = [];
            game.npcOrders = [];
            game.customers = [];
            game.workers = [];
            game.workerTasks = [];
            game.currentBuild = { 
                cpu: null, motherboard: null, cooler: null, paste: null,
                gpu: null, ram: null, storage: null, psu: null, 
                case: null, fans: null, cable: null
            };
            
            addLog('–°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞', currentUser.username);
            saveGame();
            updateUI();
            notify('–ê–¥–º–∏–Ω: –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω', 'warning');
            updateAdminStats();
        }
        
        function adminGenerateNPC() {
            for (let i = 0; i < 5; i++) {
                generateNPC();
            }
            addLog('–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤', currentUser.username, '5 –∑–∞–∫–∞–∑–æ–≤');
            notify('–ê–¥–º–∏–Ω: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ 5 –∑–∞–∫–∞–∑–æ–≤', 'success');
        }
        
        // ========== GAME SYSTEM ==========
        
        const game = {
            balance: 100000,
            debt: 0,
            debtTotal: 0,
            dailyPayment: 0,
            paymentsLeft: 0,
            interestRate: 0,
            reputation: 25,
            level: 1,
            xp: 0,
            day: 1,
            lastPaymentDate: null,
            inventory: [],
            showcase: [],
            npcOrders: [],
            customers: [],
            workers: [],
            workerTasks: [],
            currentBuild: { 
                cpu: null, motherboard: null, cooler: null, paste: null,
                gpu: null, ram: null, storage: null, psu: null, 
                case: null, fans: null, cable: null
            },
            selectedSlot: null,
            playerBuildOrder: null
        };

        const levels = [
            { level: 1, title: '–ù–æ–≤–∏—á–æ–∫', desc: '–°–æ–±–∏—Ä–∞–π—Ç–µ –ü–ö –∏ –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ –∑–∞–∫–∞–∑—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–ø—ã—Ç–∞', xpNeeded: 0, unlocks: [] },
            { level: 2, title: '–£—á–µ–Ω–∏–∫', desc: '–î–æ—Å—Ç—É–ø–Ω—ã –∑–∞–π–º—ã –¥–æ ‚Ç°200,000', xpNeeded: 500, unlocks: [] },
            { level: 3, title: '–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç', desc: '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ø–µ—Ä—Å–æ–Ω–∞–ª!', xpNeeded: 1500, unlocks: ['staff'] },
            { level: 4, title: '–ú–∞—Å—Ç–µ—Ä', desc: '–î–æ—Å—Ç—É–ø–Ω–∞ –≤–∏—Ç—Ä–∏–Ω–∞ –∏ –∑–∞–∫–∞–∑—ã!', xpNeeded: 3000, unlocks: ['showcase', 'npcOrders'] },
            { level: 5, title: '–≠–∫—Å–ø–µ—Ä—Ç', desc: '–ú–æ–∂–Ω–æ –Ω–∞–Ω–∏–º–∞—Ç—å –¥–æ 3 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤', xpNeeded: 6000, unlocks: [] },
            { level: 6, title: '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª', desc: '–î–æ—Å—Ç—É–ø–Ω–∞ –æ—á–µ—Ä–µ–¥—å –∫–ª–∏–µ–Ω—Ç–æ–≤!', xpNeeded: 10000, unlocks: ['customers'] },
            { level: 7, title: '–ì—É—Ä—É', desc: '–ú–æ–∂–Ω–æ –Ω–∞–Ω–∏–º–∞—Ç—å –¥–æ 5 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤', xpNeeded: 20000, unlocks: [] },
            { level: 8, title: '–õ–µ–≥–µ–Ω–¥–∞', desc: '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏', xpNeeded: 50000, unlocks: [] }
        ];

        const slotNames = {
            cpu: '–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä',
            motherboard: '–º–∞—Ç–µ—Ä–∏–Ω—Å–∫—É—é –ø–ª–∞—Ç—É',
            cooler: '–∫—É–ª–µ—Ä',
            paste: '—Ç–µ—Ä–º–æ–ø–∞—Å—Ç—É',
            gpu: '–≤–∏–¥–µ–æ–∫–∞—Ä—Ç—É',
            ram: '–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—É—é –ø–∞–º—è—Ç—å',
            storage: '–Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å',
            psu: '–±–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è',
            case: '–∫–æ—Ä–ø—É—Å',
            fans: '–≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä—ã',
            cable: '–∫–∞–±–µ–ª—å-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç'
        };

        // Component tiers by level
        const componentTiers = {
            1: ['budget'],
            2: ['budget', 'mid'],
            3: ['budget', 'mid'],
            4: ['budget', 'mid', 'high'],
            5: ['budget', 'mid', 'high'],
            6: ['budget', 'mid', 'high', 'enthusiast'],
            7: ['budget', 'mid', 'high', 'enthusiast'],
            8: ['budget', 'mid', 'high', 'enthusiast', 'extreme']
        };

        const allComponents = {
            cpu: [
                { id: 'c1', brand: 'Intel', name: 'Core i3-12100F', price: 8500, perf: 35, tier: 'budget', socket: 'LGA1700', tdp: 60 },
                { id: 'c2', brand: 'AMD', name: 'Ryzen 5 5600', price: 12000, perf: 50, tier: 'budget', socket: 'AM4', tdp: 65 },
                { id: 'c3', brand: 'Intel', name: 'Core i5-12400F', price: 18000, perf: 65, tier: 'mid', socket: 'LGA1700', tdp: 117 },
                { id: 'c4', brand: 'AMD', name: 'Ryzen 5 7600X', price: 28000, perf: 75, tier: 'mid', socket: 'AM5', tdp: 105 },
                { id: 'c5', brand: 'Intel', name: 'Core i7-13700K', price: 45000, perf: 88, tier: 'high', socket: 'LGA1700', tdp: 253 },
                { id: 'c6', brand: 'AMD', name: 'Ryzen 9 7950X', price: 65000, perf: 95, tier: 'enthusiast', socket: 'AM5', tdp: 170 },
                { id: 'c7', brand: 'Intel', name: 'Core i9-13900KS', price: 85000, perf: 100, tier: 'extreme', socket: 'LGA1700', tdp: 320 }
            ],
            motherboard: [
                { id: 'm1', brand: 'ASUS', name: 'Prime H610M-K', price: 6500, perf: 25, tier: 'budget', socket: 'LGA1700', formFactor: 'mATX', maxTdp: 150, size: 'mATX' },
                { id: 'm2', brand: 'Gigabyte', name: 'B550M DS3H', price: 9500, perf: 40, tier: 'budget', socket: 'AM4', formFactor: 'mATX', maxTdp: 150, size: 'mATX' },
                { id: 'm3', brand: 'MSI', name: 'B760 Tomahawk', price: 22000, perf: 60, tier: 'mid', socket: 'LGA1700', formFactor: 'ATX', maxTdp: 250, size: 'ATX' },
                { id: 'm4', brand: 'ASUS', name: 'TUF X670E-Plus', price: 38000, perf: 75, tier: 'high', socket: 'AM5', formFactor: 'ATX', maxTdp: 250, size: 'ATX' },
                { id: 'm5', brand: 'Gigabyte', name: 'Z790 Aorus Master', price: 65000, perf: 90, tier: 'enthusiast', socket: 'LGA1700', formFactor: 'E-ATX', maxTdp: 350, size: 'E-ATX' },
                { id: 'm6', brand: 'ASUS', name: 'ROG Maximus Z790 Extreme', price: 120000, perf: 100, tier: 'extreme', socket: 'LGA1700', formFactor: 'E-ATX', maxTdp: 400, size: 'E-ATX' }
            ],
            cooler_air: [
                { id: 'cl1', brand: 'DeepCool', name: 'Gammaxx 400', price: 2500, perf: 30, tier: 'budget', maxTdp: 180, type: 'air', height: 155 },
                { id: 'cl2', brand: 'ID-Cooling', name: 'SE-224-XT', price: 3500, perf: 40, tier: 'budget', maxTdp: 180, type: 'air', height: 154 },
                { id: 'cl3', brand: 'be quiet!', name: 'Dark Rock 4', price: 8500, perf: 60, tier: 'mid', maxTdp: 200, type: 'air', height: 160 },
                { id: 'cl4', brand: 'Noctua', name: 'NH-D15', price: 15000, perf: 80, tier: 'high', maxTdp: 250, type: 'air', height: 165 }
            ],
            cooler_water: [
                { id: 'cl5', brand: 'NZXT', name: 'Kraken X53', price: 22000, perf: 85, tier: 'high', maxTdp: 250, type: 'water', radiator: 240 },
                { id: 'cl6', brand: 'NZXT', name: 'Kraken X73', price: 28000, perf: 92, tier: 'enthusiast', maxTdp: 300, type: 'water', radiator: 360 },
                { id: 'cl7', brand: 'Corsair', name: 'iCUE H150i', price: 35000, perf: 95, tier: 'enthusiast', maxTdp: 320, type: 'water', radiator: 360 },
                { id: 'cl8', brand: 'Corsair', name: 'iCUE H170i Elite', price: 45000, perf: 100, tier: 'extreme', maxTdp: 350, type: 'water', radiator: 420 }
            ],
            paste: [
                { id: 'p1', brand: 'DeepCool', name: 'Z5', price: 300, perf: 20, tier: 'budget' },
                { id: 'p2', brand: 'Arctic', name: 'MX-4', price: 600, perf: 50, tier: 'mid' },
                { id: 'p3', brand: 'Noctua', name: 'NT-H2', price: 1200, perf: 75, tier: 'high' },
                { id: 'p4', brand: 'Thermal Grizzly', name: 'Kryonaut', price: 2500, perf: 95, tier: 'enthusiast' },
                { id: 'p5', brand: 'Thermal Grizzly', name: 'Conductonaut', price: 4500, perf: 100, tier: 'extreme' }
            ],
            gpu: [
                { id: 'g1', brand: 'NVIDIA', name: 'GTX 1650', price: 12000, perf: 25, tier: 'budget', tdp: 75, length: 170 },
                { id: 'g2', brand: 'AMD', name: 'RX 6650 XT', price: 28000, perf: 50, tier: 'mid', tdp: 180, length: 240 },
                { id: 'g3', brand: 'NVIDIA', name: 'RTX 3060 Ti', price: 45000, perf: 70, tier: 'mid', tdp: 200, length: 240 },
                { id: 'g4', brand: 'AMD', name: 'RX 7900 XT', price: 85000, perf: 85, tier: 'high', tdp: 300, length: 300 },
                { id: 'g5', brand: 'NVIDIA', name: 'RTX 4080', price: 130000, perf: 95, tier: 'enthusiast', tdp: 320, length: 310 },
                { id: 'g6', brand: 'NVIDIA', name: 'RTX 4090', price: 220000, perf: 100, tier: 'extreme', tdp: 450, length: 340 }
            ],
            ram: [
                { id: 'r1', brand: 'Kingston', name: 'Fury Beast 16GB', price: 5500, perf: 35, tier: 'budget' },
                { id: 'r2', brand: 'Crucial', name: 'Ballistix 32GB', price: 12000, perf: 55, tier: 'mid' },
                { id: 'r3', brand: 'G.Skill', name: 'Trident Z5 32GB', price: 22000, perf: 75, tier: 'high' },
                { id: 'r4', brand: 'Corsair', name: 'Dominator 64GB', price: 45000, perf: 90, tier: 'enthusiast' },
                { id: 'r5', brand: 'G.Skill', name: 'Trident Z5 Royal 128GB', price: 95000, perf: 100, tier: 'extreme' }
            ],
            storage: [
                { id: 's1', brand: 'Kingston', name: 'A400 480GB', price: 3500, perf: 25, tier: 'budget', size: '2.5"' },
                { id: 's2', brand: 'Samsung', name: '980 1TB', price: 8500, perf: 50, tier: 'mid', size: 'M.2' },
                { id: 's3', brand: 'WD', name: 'Black SN850X 2TB', price: 22000, perf: 75, tier: 'high', size: 'M.2' },
                { id: 's4', brand: 'Samsung', name: '990 Pro 2TB', price: 28000, perf: 90, tier: 'enthusiast', size: 'M.2' },
                { id: 's5', brand: 'Corsair', name: 'MP700 4TB', price: 65000, perf: 100, tier: 'extreme', size: 'M.2' }
            ],
            psu: [
                { id: 'ps1', brand: 'DeepCool', name: 'PK550D', price: 5500, perf: 35, tier: 'budget', wattage: 550, length: 140 },
                { id: 'ps2', brand: 'be quiet!', name: 'Pure Power 12 650W', price: 12000, perf: 55, tier: 'mid', wattage: 650, length: 160 },
                { id: 'ps3', brand: 'Corsair', name: 'RM850x', price: 18000, perf: 75, tier: 'high', wattage: 850, length: 160 },
                { id: 'ps4', brand: 'ASUS', name: 'ROG Thor 1000W', price: 45000, perf: 92, tier: 'enthusiast', wattage: 1000, length: 170 },
                { id: 'ps5', brand: 'Corsair', name: 'AX1600i', price: 85000, perf: 100, tier: 'extreme', wattage: 1600, length: 200 }
            ],
            case: [
                { id: 'ca1', brand: 'DeepCool', name: 'Matrexx 30', price: 3500, perf: 20, tier: 'budget', formFactor: 'mATX', maxGpu: 280, maxCooler: 150, maxPsu: 150, fanSlots: [120], waterSupport: [120, 240] },
                { id: 'ca2', brand: 'Fractal', name: 'Focus G', price: 7500, perf: 45, tier: 'mid', formFactor: 'ATX', maxGpu: 380, maxCooler: 165, maxPsu: 200, fanSlots: [120, 140], waterSupport: [120, 240, 280] },
                { id: 'ca3', brand: 'NZXT', name: 'H7 Flow', price: 18000, perf: 70, tier: 'high', formFactor: 'ATX', maxGpu: 400, maxCooler: 185, maxPsu: 220, fanSlots: [120, 140], waterSupport: [120, 240, 280, 360] },
                { id: 'ca4', brand: 'be quiet!', name: 'Dark Base Pro 900', price: 35000, perf: 90, tier: 'enthusiast', formFactor: 'E-ATX', maxGpu: 470, maxCooler: 190, maxPsu: 250, fanSlots: [120, 140], waterSupport: [120, 240, 280, 360, 420] },
                { id: 'ca5', brand: 'Corsair', name: 'Obsidian 1000D', price: 75000, perf: 100, tier: 'extreme', formFactor: 'E-ATX', maxGpu: 500, maxCooler: 200, maxPsu: 300, fanSlots: [120, 140], waterSupport: [120, 240, 280, 360, 420, 480] }
            ],
            fans: [
                { id: 'f1', brand: 'Arctic', name: 'P12 PWM PST', price: 400, perf: 25, tier: 'budget', size: 120 },
                { id: 'f2', brand: 'Noctua', name: 'NF-P12 redux', price: 1200, perf: 50, tier: 'mid', size: 120 },
                { id: 'f3', brand: 'be quiet!', name: 'Silent Wings 4', price: 2500, perf: 75, tier: 'high', size: 140 },
                { id: 'f4', brand: 'Corsair', name: 'LL120 RGB', price: 8500, perf: 90, tier: 'enthusiast', size: 120 },
                { id: 'f5', brand: 'Noctua', name: 'NF-A14', price: 3500, perf: 100, tier: 'extreme', size: 140 }
            ],
            cable: [
                { id: 'cb1', brand: 'DeepCool', name: '–ù–∞–±–æ—Ä —Å—Ç—è–∂–µ–∫', price: 300, perf: 20, tier: 'budget' },
                { id: 'cb2', brand: 'CableMod', name: 'Basic Extension Kit', price: 2500, perf: 50, tier: 'mid' },
                { id: 'cb3', brand: 'CableMod', name: 'Pro ModMesh Kit', price: 8500, perf: 75, tier: 'high' },
                { id: 'cb4', brand: 'Lian Li', name: 'Strimer Plus V2', price: 18000, perf: 95, tier: 'enthusiast' }
            ]
        };

        const workers = [
            { id: 'w1', name: '–°—Ç–∞–∂—ë—Ä', desc: '–ü–æ–º–æ–≥–∞–µ—Ç —Å –ø—Ä–æ—Å—Ç—ã–º–∏ –∑–∞–∫–∞–∑–∞–º–∏', salary: 2000, profit: 3000, minLevel: 3, max: 2, speed: 1, buildTime: 3 },
            { id: 'w2', name: '–ú–ª–∞–¥—à–∏–π —Å–±–æ—Ä—â–∏–∫', desc: '–°–æ–±–∏—Ä–∞–µ—Ç –±—é–¥–∂–µ—Ç–Ω—ã–µ –ü–ö', salary: 5000, profit: 8000, minLevel: 4, max: 2, speed: 1.2, buildTime: 2 },
            { id: 'w3', name: '–°–±–æ—Ä—â–∏–∫', desc: '–û–ø—ã—Ç–Ω—ã–π —Ä–∞–±–æ—Ç–Ω–∏–∫', salary: 12000, profit: 20000, minLevel: 5, max: 2, speed: 1.5, buildTime: 1 },
            { id: 'w4', name: '–°—Ç–∞—Ä—à–∏–π –º–∞—Å—Ç–µ—Ä', desc: '–°–æ–±–∏—Ä–∞–µ—Ç –ø—Ä–µ–º–∏—É–º –ü–ö', salary: 25000, profit: 45000, minLevel: 6, max: 1, speed: 2, buildTime: 1 },
            { id: 'w5', name: '–≠–∫—Å–ø–µ—Ä—Ç', desc: '–õ—É—á—à–∏–π –≤ —Å–≤–æ—ë–º –¥–µ–ª–µ', salary: 50000, profit: 100000, minLevel: 7, max: 1, speed: 3, buildTime: 0 }
        ];

        const npcNames = ['–ê–ª–µ–∫—Å–µ–π', '–ú–∞—Ä–∏—è', '–î–º–∏—Ç—Ä–∏–π', '–ê–Ω–Ω–∞', '–°–µ—Ä–≥–µ–π', '–ï–ª–µ–Ω–∞', '–ú–∞–∫—Å–∏–º', '–û–ª—å–≥–∞', '–ò–≤–∞–Ω', '–ù–∞—Ç–∞–ª—å—è', '–ê—Ä—Ç—ë–º', '–°–æ—Ñ–∏—è', '–ö–∏—Ä–∏–ª–ª', '–í–∏–∫—Ç–æ—Ä–∏—è', '–ù–∏–∫–∏—Ç–∞'];
        const npcRequests = [
            '–ù—É–∂–µ–Ω –ü–ö –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏',
            '–°–æ–±–∏—Ä–∞—é—Å—å —Å—Ç—Ä–∏–º–∏—Ç—å –Ω–∞ Twitch',
            '–•–æ—á—É –∏–≥—Ä–∞—Ç—å –≤ Cyberpunk 2077 –Ω–∞ —É–ª—å—Ç—Ä–∞—Ö',
            '–ù—É–∂–Ω–∞ —Ä–∞–±–æ—á–∞—è —Å—Ç–∞–Ω—Ü–∏—è –¥–ª—è –º–æ–Ω—Ç–∞–∂–∞ –≤–∏–¥–µ–æ',
            '–ü–æ–∫—É–ø–∞—é —Å—ã–Ω—É –¥–ª—è —É—á—ë–±—ã',
            '–°–µ—Ä–≤–µ—Ä –¥–ª—è –¥–æ–º–∞—à–Ω–µ–π –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏',
            '–ù—É–∂–µ–Ω –±–µ—Å—à—É–º–Ω—ã–π –ü–ö –¥–ª—è —Å—Ç—É–¥–∏–∏',
            '–•–æ—á—É –º–∞–π–Ω–∏—Ç—å –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—É',
            '–ù—É–∂–µ–Ω –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –ü–ö –¥–ª—è –≥–æ—Å—Ç–∏–Ω–æ–π',
            '–°–æ–±–∏—Ä–∞—é –ü–ö –¥–ª—è 3D-–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è'
        ];

        let currentCoolerTab = 'air';

        function startGame() {
            // Update UI with username
            document.getElementById('usernameDisplay').textContent = currentUser.username;
            document.getElementById('userAvatar').textContent = currentUser.username.charAt(0).toUpperCase();
            document.getElementById('profileUsername').textContent = currentUser.username;
            
            // Show admin badge only for admin users
            const adminBadge = document.getElementById('adminBadge');
            if (isAdmin) {
                adminBadge.style.display = 'inline-block';
            } else {
                adminBadge.style.display = 'none';
            }
            
            // Show admin button only for admin
            document.getElementById('adminToggle').style.display = isAdmin ? 'block' : 'none';
            
            loadGame();
            checkDayChange();
            updateUI();
            updateLoan();
            
            // Only generate NPC if level >= 4
            if (game.level >= 4) {
                generateNPC();
            }
            
            setInterval(checkDayChange, 60000);
            setInterval(updateNextPayment, 1000);
            setInterval(processWorkerTasks, 30000);
            setInterval(generateCustomers, 45000);
            setInterval(processCustomers, 60000);
            
            notify(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${currentUser.username}!`, 'success');
        }

        function loadGame() {
            if (!currentUser) return;
            
            const db = getAuthDB();
            const user = db[currentUser.username];
            
            if (user && user.gameData) {
                Object.assign(game, user.gameData);
                if (!game.workers) game.workers = [];
                if (!game.npcOrders) game.npcOrders = [];
                if (!game.customers) game.customers = [];
                if (!game.workerTasks) game.workerTasks = [];
                if (!game.showcase) game.showcase = [];
                
                // Check unlocks based on level
                checkUnlocks();
            }
        }

        function checkUnlocks() {
            // Check all levels up to current
            for (let i = 0; i < game.level; i++) {
                const levelData = levels[i];
                if (levelData && levelData.unlocks) {
                    levelData.unlocks.forEach(unlock => {
                        if (unlock === 'staff') document.getElementById('staffTab').disabled = false;
                        if (unlock === 'showcase') document.getElementById('showcaseTab').disabled = false;
                        if (unlock === 'npcOrders') document.getElementById('npcTab').disabled = false;
                        if (unlock === 'customers') document.getElementById('customersTab').disabled = false;
                    });
                }
            }
        }

        function saveGame() {
            if (!currentUser) return;
            
            const db = getAuthDB();
            if (db[currentUser.username]) {
                db[currentUser.username].gameData = {...game};
                db[currentUser.username].lastSave = new Date().toISOString();
                saveAuthDB(db);
            }
        }

        function checkDayChange() {
            const today = new Date().toDateString();
            
            if (game.lastPaymentDate !== today) {
                game.day++;
                game.lastPaymentDate = today;
                
                if (game.debt > 0 && game.paymentsLeft > 0) {
                    processDailyPayment();
                }
                
                processSalaries();
                
                // Generate NPC only if level >= 4
                if (game.level >= 4 && Math.random() > 0.3) generateNPC();
                
                saveGame();
                updateUI();
                notify(`–ù–æ–≤—ã–π –¥–µ–Ω—å! –î–µ–Ω—å ${game.day}`, 'info');
            }
        }

        function processDailyPayment() {
            if (game.balance >= game.dailyPayment) {
                game.balance -= game.dailyPayment;
                game.debt -= game.dailyPayment;
                game.paymentsLeft--;
                
                if (game.debt <= 0) {
                    game.debt = 0;
                    notify('–ö—Ä–µ–¥–∏—Ç –ø–æ–≥–∞—à–µ–Ω!', 'success');
                }
            } else {
                game.reputation = Math.max(0, game.reputation - 20);
                game.paymentsLeft = Math.max(0, game.paymentsLeft - 1);
                notify('–ü—Ä–æ—Å—Ä–æ—á–∫–∞ –ø–ª–∞—Ç–µ–∂–∞! -20‚òÖ', 'error');
            }
        }

        function processSalaries() {
            const totalSalaries = game.workers.reduce((a, w) => a + w.salary * w.count, 0);
            
            if (totalSalaries > 0) {
                if (game.balance >= totalSalaries) {
                    game.balance -= totalSalaries;
                    notify(`–ó–∞—Ä–ø–ª–∞—Ç—ã –≤—ã–ø–ª–∞—á–µ–Ω—ã: ‚Ç°${totalSalaries.toLocaleString()}`, 'info');
                } else {
                    notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞ –∑–∞—Ä–ø–ª–∞—Ç—ã! –†–∞–±–æ—Ç–Ω–∏–∫–∏ —É–≤–æ–ª–µ–Ω—ã', 'error');
                    game.workers = [];
                }
            }
        }

        function addXP(amount) {
            game.xp += amount;
            checkLevel();
        }

        function checkLevel() {
            let newLevel = 1;
            for (let i = levels.length - 1; i >= 0; i--) {
                if (game.xp >= levels[i].xpNeeded) {
                    newLevel = levels[i].level;
                    break;
                }
            }
            
            if (newLevel > game.level) {
                const oldLevel = game.level;
                game.level = newLevel;
                const levelData = levels.find(l => l.level === newLevel);
                notify(`–ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å: ${levelData.title}!`, 'success');
                
                // Process unlocks
                if (levelData.unlocks) {
                    levelData.unlocks.forEach(unlock => {
                        if (unlock === 'staff') {
                            document.getElementById('staffTab').disabled = false;
                            notify('–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ø–µ—Ä—Å–æ–Ω–∞–ª!', 'info');
                        }
                        if (unlock === 'showcase') {
                            document.getElementById('showcaseTab').disabled = false;
                            notify('–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –≤–∏—Ç—Ä–∏–Ω–∞!', 'info');
                        }
                        if (unlock === 'npcOrders') {
                            document.getElementById('npcTab').disabled = false;
                            notify('–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –∑–∞–∫–∞–∑—ã!', 'info');
                        }
                        if (unlock === 'customers') {
                            document.getElementById('customersTab').disabled = false;
                            notify('–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –æ—á–µ—Ä–µ–¥—å –∫–ª–∏–µ–Ω—Ç–æ–≤!', 'info');
                        }
                    });
                }
            }
            
            updateLevelUI();
        }

        function updateLevelUI() {
            const levelData = levels.find(l => l.level === game.level);
            const nextLevel = levels.find(l => l.level === game.level + 1);
            
            document.getElementById('level').textContent = game.level;
            document.getElementById('day').textContent = game.day;
            document.getElementById('levelIcon').textContent = game.level;
            document.getElementById('levelTitle').textContent = levelData.title;
            document.getElementById('levelDesc').textContent = levelData.desc;
            
            if (nextLevel) {
                const progress = ((game.xp - levelData.xpNeeded) / (nextLevel.xpNeeded - levelData.xpNeeded)) * 100;
                document.getElementById('xpFill').style.width = `${Math.min(100, progress)}%`;
                document.getElementById('xp').textContent = `${game.xp}/${nextLevel.xpNeeded}`;
            } else {
                document.getElementById('xpFill').style.width = '100%';
                document.getElementById('xp').textContent = 'MAX';
            }
        }

        // ========== NPC ORDERS SYSTEM ==========
        
        function generateNPC() {
            // Only generate if level >= 4
            if (game.level < 4) return;
            
            if (game.npcOrders.filter(n => n.status === 'waiting').length >= 5) {
                return;
            }
            
            const name = npcNames[Math.floor(Math.random() * npcNames.length)];
            const request = npcRequests[Math.floor(Math.random() * npcRequests.length)];
            
            // Generate components based on available tiers
            const npcComponents = generateNPCComponents();
            const totalCost = Object.values(npcComponents).reduce((a, c) => a + (c?.price || 0), 0);
            
            const npc = {
                id: Date.now(),
                name: name,
                request: request,
                components: npcComponents,
                costPrice: totalCost,
                offeredPrice: 0,
                deadline: 0,
                deadlineDay: 0,
                status: 'waiting',
                urgent: Math.random() > 0.7,
                patience: 3 + Math.floor(Math.random() * 3),
                createdDay: game.day,
                discountRequested: false,
                discountPercent: 0,
                assignedWorker: null
            };
            
            game.npcOrders.push(npc);
            updateNPCList();
            saveGame();
            notify(`–ù–æ–≤—ã–π –∑–∞–∫–∞–∑ –æ—Ç ${name}!`, 'success');
            
            document.getElementById('npcTab').classList.add('pulse');
            setTimeout(() => document.getElementById('npcTab').classList.remove('pulse'), 3000);
        }
        
        function generateNPCComponents() {
            const comps = {};
            const availableTiers = componentTiers[game.level] || ['budget'];
            
            // Filter CPUs by available tiers
            const availableCPUs = allComponents.cpu.filter(c => availableTiers.includes(c.tier));
            const cpu = availableCPUs[Math.floor(Math.random() * availableCPUs.length)] || allComponents.cpu[0];
            
            // Find compatible motherboard
            const availableMBs = allComponents.motherboard.filter(m => 
                availableTiers.includes(m.tier) && m.socket === cpu.socket
            );
            const mb = availableMBs[0] || allComponents.motherboard.find(m => m.socket === cpu.socket) || allComponents.motherboard[0];
            
            comps.cpu = cpu;
            comps.motherboard = mb;
            
            // Cooler
            const coolerList = [...allComponents.cooler_air, ...allComponents.cooler_water].filter(c => availableTiers.includes(c.tier));
            comps.cooler = coolerList.find(c => c.maxTdp >= cpu.tdp) || allComponents.cooler_air[0];
            
            // Paste
            const availablePastes = allComponents.paste.filter(p => availableTiers.includes(p.tier));
            comps.paste = availablePastes[Math.floor(Math.random() * availablePastes.length)] || allComponents.paste[0];
            
            // GPU
            const availableGPUs = allComponents.gpu.filter(g => availableTiers.includes(g.tier));
            comps.gpu = availableGPUs[Math.floor(Math.random() * availableGPUs.length)] || allComponents.gpu[0];
            
            // RAM
            const availableRAMs = allComponents.ram.filter(r => availableTiers.includes(r.tier));
            comps.ram = availableRAMs[Math.floor(Math.random() * availableRAMs.length)] || allComponents.ram[0];
            
            // Storage
            const availableStorages = allComponents.storage.filter(s => availableTiers.includes(s.tier));
            comps.storage = availableStorages[Math.floor(Math.random() * availableStorages.length)] || allComponents.storage[0];
            
            // PSU
            const availablePSUs = allComponents.psu.filter(p => availableTiers.includes(p.tier));
            comps.psu = availablePSUs.find(p => p.wattage >= (cpu.tdp + (comps.gpu?.tdp || 0)) * 1.3) || allComponents.psu[0];
            
            // Case
            const availableCases = allComponents.case.filter(c => availableTiers.includes(c.tier));
            comps.case = availableCases[Math.floor(Math.random() * availableCases.length)] || allComponents.case[0];
            
            // Fans
            const availableFans = allComponents.fans.filter(f => availableTiers.includes(f.tier));
            comps.fans = availableFans[Math.floor(Math.random() * availableFans.length)] || allComponents.fans[0];
            
            // Cable
            const availableCables = allComponents.cable.filter(c => availableTiers.includes(c.tier));
            comps.cable = availableCables[Math.floor(Math.random() * availableCables.length)] || allComponents.cable[0];
            
            return comps;
        }
        
        function updateNPCList() {
            const list = document.getElementById('npcList');
            const activeNPCs = game.npcOrders.filter(n => n.status !== 'completed' && n.status !== 'cancelled');
            document.getElementById('npcCount').textContent = activeNPCs.length;
            
            if (activeNPCs.length === 0) {
                list.innerHTML = '<div style="text-align: center; padding: 40px; color: #6b7280;">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div>';
                return;
            }
            
            list.innerHTML = activeNPCs.map(npc => {
                const isWaiting = npc.status === 'waiting';
                const isProcessing = npc.status === 'processing';
                const isReady = npc.status === 'ready';
                
                let statusClass = 'status-waiting';
                let statusText = '–û–∂–∏–¥–∞–µ—Ç';
                if (isProcessing) { statusClass = 'status-processing'; statusText = '–í —Ä–∞–±–æ—Ç–µ'; }
                if (isReady) { statusClass = 'status-ready'; statusText = '–ì–æ—Ç–æ–≤!'; }
                
                const daysWaiting = game.day - npc.createdDay;
                const patienceLeft = npc.patience - daysWaiting;
                
                return `
                    <div class="npc-card ${isProcessing ? 'processing' : ''} ${isReady ? 'ready' : ''}" onclick="openNPCDetails(${npc.id})">
                        <div class="npc-header">
                            <div>
                                <span class="npc-name">${npc.name}</span>
                                ${npc.urgent ? '<span class="urgent-indicator">–°–†–û–ß–ù–û</span>' : ''}
                            </div>
                            <span class="npc-status ${statusClass}">${statusText}</span>
                        </div>
                        
                        <div class="npc-request">
                            <div class="npc-request-title">üìù ${npc.request}</div>
                            <div style="color: #9ca3af; font-size: 0.85em; margin-bottom: 8px;">–ö–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏–µ –Ω–∞ ‚Ç°${npc.costPrice.toLocaleString()}</div>
                            ${isProcessing ? `
                                <div style="color: #3b82f6; font-size: 0.85em;">
                                    üë∑ –°–æ–±–∏—Ä–∞–µ—Ç: ${npc.assignedWorker}
                                </div>
                            ` : ''}
                        </div>
                        
                        ${isWaiting ? `
                            <div class="npc-hint ${patienceLeft <= 1 ? 'warning' : ''}">
                                ${patienceLeft > 0 ? `‚è≥ –ñ–¥—ë—Ç ${patienceLeft} –¥–Ω.` : '‚ö†Ô∏è –£–π–¥—ë—Ç —Å–µ–≥–æ–¥–Ω—è!'}
                            </div>
                        ` : ''}
                        
                        ${isReady ? `
                            <div class="npc-hint success">
                                ‚úÖ –ü—Ä–∏–±—ã–ª—å: ‚Ç°${(npc.offeredPrice - npc.costPrice).toLocaleString()}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }
        
        function openNPCDetails(npcId) {
            const npc = game.npcOrders.find(n => n.id === npcId);
            if (!npc) return;
            
            const content = document.getElementById('modalContent');
            
            if (npc.status === 'waiting') {
                const minPrice = Math.floor(npc.costPrice * 1.20);
                const maxPrice = Math.floor(npc.costPrice * 1.30);
                const recommendedPrice = Math.floor(npc.costPrice * 1.25);
                
                const availableWorkers = game.workers.filter(w => {
                    const assignedCount = game.npcOrders.filter(o => o.assignedWorker === w.name && o.status === 'processing').length;
                    return assignedCount < w.count;
                });
                
                content.innerHTML = `
                    <h3 style="margin-bottom: 20px;">üí¨ –ó–∞–∫–∞–∑ –æ—Ç ${npc.name}</h3>
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <p style="margin-bottom: 10px;"><strong>"${npc.request}"</strong></p>
                        <p style="color: #9ca3af; font-size: 0.9em;">–•–æ—á—É —ç—Ç–∏ –∫–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏–µ. –°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç —Å—Ç–æ–∏—Ç—å —Å–±–æ—Ä–∫–∞?</p>
                    </div>
                    
                    <div class="npc-request" style="max-height: 150px; overflow-y: auto;">
                        ${Object.entries(npc.components).map(([type, comp]) => `
                            <div class="npc-component">
                                <span>${slotNames[type]}: ${comp.brand} ${comp.name}</span>
                                <span style="color: #10b981;">‚Ç°${comp.price.toLocaleString()}</span>
                            </div>
                        `).join('')}
                        <div class="npc-total">
                            <span>–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å:</span>
                            <span>‚Ç°${npc.costPrice.toLocaleString()}</span>
                        </div>
                    </div>
                    
                    <div class="npc-price-section">
                        <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid #f59e0b; padding: 10px; border-radius: 6px; margin-bottom: 15px; font-size: 0.9em;">
                            üí° <strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong> –ù–∞—Ü–µ–Ω–∫–∞ 20-30%. –ë–æ–ª—å—à–µ 30% - –∫–ª–∏–µ–Ω—Ç –æ—Ç–∫–∞–∂–µ—Ç—Å—è.
                        </div>
                        
                        <div class="price-input-row">
                            <label>–í–∞—à–∞ —Ü–µ–Ω–∞:</label>
                            <input type="number" id="npcPriceInput" value="${recommendedPrice}" min="${minPrice}" step="500" 
                                   style="flex: 1; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #fff; padding: 10px; border-radius: 6px;">
                        </div>
                        
                        <div class="price-display" id="priceDisplay">‚Ç°${recommendedPrice.toLocaleString()}</div>
                        <div class="profit-display" id="profitDisplay">–ü—Ä–∏–±—ã–ª—å: ‚Ç°${(recommendedPrice - npc.costPrice).toLocaleString()} (${Math.floor((recommendedPrice/npc.costPrice-1)*100)}%)</div>
                        
                        <div style="margin-top: 15px;">
                            <label style="color: #9ca3af; display: block; margin-bottom: 8px;">–ù–∞–∑–Ω–∞—á–∏—Ç—å —Å–±–æ—Ä—â–∏–∫–∞:</label>
                            ${availableWorkers.length > 0 ? `
                                <select id="workerSelect" style="width: 100%; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #fff; padding: 10px; border-radius: 6px;">
                                    ${availableWorkers.map(w => `<option value="${w.name}">${w.name} (—Å–∫–æ—Ä–æ—Å—Ç—å: ${w.speed}x)</option>`).join('')}
                                </select>
                            ` : '<div style="color: #ef4444;">–ù–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–±–æ—Ä—â–∏–∫–æ–≤! –ù–∞–Ω–º–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª.</div>'}
                        </div>
                        
                        <div class="reputation-bar">
                            <span>–®–∞–Ω—Å —Å–æ–≥–ª–∞—Å–∏—è:</span>
                            <div class="rep-indicator">
                                <div class="rep-fill" id="successChance" style="width: 90%"></div>
                            </div>
                            <span id="successText">90%</span>
                        </div>
                    </div>
                    
                    <div class="npc-actions">
                        <button class="btn btn-success" onclick="submitNPCOffer(${npc.id})" style="flex: 1;" ${availableWorkers.length === 0 ? 'disabled' : ''}>
                            ‚úÖ –ù–∞–∑–Ω–∞—á–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                        </button>
                        <button class="btn btn-warning" onclick="setupPlayerBuild(${npc.id})" style="flex: 1;">
                            üéÆ –°–æ–±—Ä–∞—Ç—å —Å–∞–º–æ–º—É
                        </button>
                        <button class="btn btn-danger" onclick="declineNPC(${npc.id})" style="flex: 1;">
                            ‚ùå –û—Ç–∫–∞–∑–∞—Ç—å
                        </button>
                    </div>
                `;
                
                setTimeout(() => {
                    const priceInput = document.getElementById('npcPriceInput');
                    
                    const updateCalculations = () => {
                        const price = parseInt(priceInput.value) || minPrice;
                        
                        document.getElementById('priceDisplay').textContent = `‚Ç°${price.toLocaleString()}`;
                        const profit = price - npc.costPrice;
                        const percent = Math.floor((price/npc.costPrice-1)*100);
                        document.getElementById('profitDisplay').textContent = `–ü—Ä–∏–±—ã–ª—å: ‚Ç°${profit.toLocaleString()} (${percent}%)`;
                        document.getElementById('profitDisplay').style.color = percent >= 20 ? '#10b981' : '#ef4444';
                        
                        let chance = 100;
                        if (price > npc.costPrice * 1.30) chance = 0;
                        else if (price > npc.costPrice * 1.28) chance = 20;
                        else if (price > npc.costPrice * 1.25) chance = 50;
                        else if (price > npc.costPrice * 1.22) chance = 75;
                        else chance = 95;
                        
                        document.getElementById('successChance').style.width = chance + '%';
                        document.getElementById('successText').textContent = chance + '%';
                        document.getElementById('successText').style.color = chance > 70 ? '#10b981' : chance > 30 ? '#f59e0b' : '#ef4444';
                    };
                    
                    priceInput.addEventListener('input', updateCalculations);
                    updateCalculations();
                }, 100);
                
            } else if (npc.status === 'ready') {
                content.innerHTML = `
                    <h3 style="margin-bottom: 20px;">‚úÖ –ó–∞–∫–∞–∑ –≥–æ—Ç–æ–≤! ${npc.name}</h3>
                    <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid #10b981; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <p>–ü–ö —Å–æ–±—Ä–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –≤—ã–¥–∞—á–µ!</p>
                        <p style="margin-top: 10px;"><strong>–í–∞—à–∞ –ø—Ä–∏–±—ã–ª—å:</strong> <span style="color: #10b981; font-size: 1.5em;">‚Ç°${(npc.offeredPrice - npc.costPrice).toLocaleString()}</span></p>
                    </div>
                    <button class="btn btn-success" onclick="completeNPCOrder(${npc.id})" style="width: 100%;">
                        üí∞ –í—ã–¥–∞—Ç—å –ü–ö –∏ –ø–æ–ª—É—á–∏—Ç—å –æ–ø–ª–∞—Ç—É
                    </button>
                `;
            } else if (npc.status === 'processing') {
                content.innerHTML = `
                    <h3 style="margin-bottom: 20px;">‚è≥ –í —Ä–∞–±–æ—Ç–µ</h3>
                    <p>${npc.name} –∂–¥—ë—Ç —Å–≤–æ–π –ü–ö.</p>
                    <p>–°–±–æ—Ä—â–∏–∫: ${npc.assignedWorker}</p>
                    <button class="btn btn-primary" onclick="closeModal()" style="width: 100%; margin-top: 20px;">–ó–∞–∫—Ä—ã—Ç—å</button>
                `;
            }
            
            document.getElementById('modal').classList.add('active');
        }
        
        function setupPlayerBuild(npcId) {
            const npc = game.npcOrders.find(n => n.id === npcId);
            if (!npc) return;
            
            game.playerBuildOrder = npc;
            closeModal();
            
            // Switch to workshop tab
            switchTab('workshop');
            
            // Pre-fill components
            game.currentBuild = {...npc.components};
            updateBuildUI();
            
            notify(`–°–æ–±–µ—Ä–∏—Ç–µ –ü–ö –¥–ª—è ${npc.name}! –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —É–∂–µ –≤—ã–±—Ä–∞–Ω—ã.`, 'info');
            
            // Show player build section
            document.getElementById('playerBuildSection').style.display = 'block';
            document.getElementById('playerBuildTarget').innerHTML = `
                <p><strong>–ö–ª–∏–µ–Ω—Ç:</strong> ${npc.name}</p>
                <p><strong>–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å:</strong> ‚Ç°${npc.costPrice.toLocaleString()}</p>
                <p style="color: #f59e0b;">‚ö†Ô∏è –ü—Ä–∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–µ –ø—Ä–∏–±—ã–ª—å -20%</p>
            `;
        }
        
        function startPlayerBuild() {
            if (!game.playerBuildOrder) {
                notify('–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ –¥–ª—è —Å–±–æ—Ä–∫–∏!', 'error');
                return;
            }
            
            const npc = game.playerBuildOrder;
            
            if (!checkCompatibility()) {
                notify('–ò—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏!', 'error');
                return;
            }
            
            // Check if components match
            let match = true;
            for (const [type, comp] of Object.entries(npc.components)) {
                if (game.currentBuild[type]?.id !== comp.id) {
                    match = false;
                    break;
                }
            }
            
            if (!match) {
                notify('–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∑–∞–∫–∞–∑—É!', 'error');
                return;
            }
            
            // Calculate price with -20% profit
            const baseProfit = Math.floor(npc.costPrice * 0.25);
            const reducedProfit = Math.floor(baseProfit * 0.8);
            const finalPrice = npc.costPrice + reducedProfit;
            
            npc.offeredPrice = finalPrice;
            npc.status = 'ready';
            npc.assignedWorker = '–í—ã (—Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ)';
            
            game.playerBuildOrder = null;
            document.getElementById('playerBuildSection').style.display = 'none';
            
            // Clear build
            Object.keys(game.currentBuild).forEach(k => game.currentBuild[k] = null);
            updateBuildUI();
            
            updateNPCList();
            saveGame();
            notify(`–ü–ö —Å–æ–±—Ä–∞–Ω! –ü—Ä–∏–±—ã–ª—å —Å–Ω–∏–∂–µ–Ω–∞ –Ω–∞ 20%.`, 'success');
        }
        
        function submitNPCOffer(npcId) {
            const npc = game.npcOrders.find(n => n.id === npcId);
            const price = parseInt(document.getElementById('npcPriceInput').value);
            const workerName = document.getElementById('workerSelect').value;
            
            if (price < npc.costPrice * 1.20) {
                notify('–ú–∏–Ω–∏–º—É–º 20% –Ω–∞—Ü–µ–Ω–∫–∏!', 'error');
                return;
            }
            
            let chance = 100;
            if (price > npc.costPrice * 1.30) chance = 0;
            else if (price > npc.costPrice * 1.28) chance = 20;
            else if (price > npc.costPrice * 1.25) chance = 50;
            else if (price > npc.costPrice * 1.22) chance = 75;
            else chance = 95;
            
            if (Math.random() * 100 <= chance) {
                npc.offeredPrice = price;
                npc.status = 'processing';
                npc.assignedWorker = workerName;
                
                const worker = game.workers.find(w => w.name === workerName);
                const buildTime = worker.buildTime || 3;
                
                npc.deadlineDay = game.day + buildTime;
                
                closeModal();
                updateNPCList();
                saveGame();
                notify(`${npc.name} —Å–æ–≥–ª–∞—Å–µ–Ω! ${workerName} –Ω–∞—á–∞–ª —Å–±–æ—Ä–∫—É.`, 'success');
            } else {
                npc.status = 'cancelled';
                closeModal();
                updateNPCList();
                saveGame();
                notify(`${npc.name}: "–î–æ—Ä–æ–≥–æ!" - –æ—Ç–∫–∞–∑–∞–ª—Å—è`, 'error');
            }
        }
        
        function declineNPC(npcId) {
            const npc = game.npcOrders.find(n => n.id === npcId);
            npc.status = 'cancelled';
            closeModal();
            updateNPCList();
            saveGame();
            notify('–ó–∞–∫–∞–∑ –æ—Ç–∫–ª–æ–Ω—ë–Ω', 'warning');
        }
        
        function completeNPCOrder(npcId) {
            const npc = game.npcOrders.find(n => n.id === npcId);
            const profit = npc.offeredPrice - npc.costPrice;
            
            game.balance += npc.offeredPrice;
            addXP(Math.floor(profit / 500));
            game.reputation += 5;
            
            npc.status = 'completed';
            
            closeModal();
            updateNPCList();
            updateUI();
            saveGame();
            notify(`+‚Ç°${npc.offeredPrice.toLocaleString()}, +${Math.floor(profit/500)} XP`, 'success');
        }

        // ========== WORKER TASKS SYSTEM ==========
        
        function processWorkerTasks() {
            game.npcOrders.forEach(npc => {
                if (npc.status === 'processing' && npc.deadlineDay <= game.day) {
                    npc.status = 'ready';
                    notify(`–ó–∞–∫–∞–∑ –¥–ª—è ${npc.name} —Å–æ–±—Ä–∞–Ω!`, 'success');
                }
            });
            
            updateNPCList();
            updateWorkerTasks();
            saveGame();
        }
        
        function updateWorkerTasks() {
            const container = document.getElementById('workerTasks');
            const activeTasks = game.npcOrders.filter(n => n.status === 'processing');
            
            document.getElementById('taskCount').textContent = activeTasks.length;
            
            if (activeTasks.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: #6b7280;">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á</div>';
                return;
            }
            
            container.innerHTML = activeTasks.map(npc => {
                const progress = Math.min(100, ((game.day - (npc.deadlineDay - 3)) / 3) * 100);
                
                return `
                    <div class="task-card">
                        <div class="task-header">
                            <div>
                                <span class="task-type task-order">–ó–∞–∫–∞–∑</span>
                                <span style="margin-left: 10px; font-weight: 700;">${npc.name}</span>
                            </div>
                            <span style="color: #9ca3af; font-size: 0.85em;">${npc.assignedWorker}</span>
                        </div>
                        <div style="font-size: 0.85em; color: #9ca3af; margin-bottom: 10px;">
                            –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å: –¥–µ–Ω—å ${npc.deadlineDay}
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ========== CUSTOMER QUEUE SYSTEM ==========
        
        function generateCustomers() {
            // Only generate if level >= 6
            if (game.level < 6) return;
            
            if (game.customers.length >= 5) return;
            
            const customer = {
                id: Date.now(),
                name: npcNames[Math.floor(Math.random() * npcNames.length)],
                budget: 30000 + Math.floor(Math.random() * 300000), // Higher budget
                preferences: ['budget', 'mid', 'high', 'enthusiast'][Math.floor(Math.random() * 4)],
                status: 'looking',
                targetPC: null,
                waitTime: 0,
                maxWait: 2 + Math.floor(Math.random() * 3)
            };
            
            game.customers.push(customer);
            updateCustomerQueue();
            saveGame();
            
            document.getElementById('customersTab').classList.add('pulse');
            setTimeout(() => document.getElementById('customersTab').classList.remove('pulse'), 3000);
        }
        
        function processCustomers() {
            // Only process if level >= 6
            if (game.level < 6) return;
            
            game.customers.forEach((customer, index) => {
                if (customer.status === 'looking') {
                    const suitablePCs = game.showcase.filter(pc => {
                        const tierMatch = pc.components.cpu.tier === customer.preferences || 
                                         pc.components.gpu.tier === customer.preferences;
                        return pc.price <= customer.budget && tierMatch && !pc.reserved;
                    });
                    
                    if (suitablePCs.length > 0) {
                        const pc = suitablePCs[0];
                        const reserveChance = 30 + (game.reputation / 2);
                        
                        if (Math.random() * 100 <= reserveChance) {
                            pc.reserved = true;
                            pc.reservedBy = customer.name;
                            customer.status = 'reserved';
                            customer.targetPC = pc.id;
                            notify(`${customer.name} –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–ª –ü–ö –Ω–∞ –≤–∏—Ç—Ä–∏–Ω–µ!`, 'success');
                        }
                    }
                    
                    customer.waitTime++;
                    if (customer.waitTime >= customer.maxWait) {
                        game.customers.splice(index, 1);
                        notify(`${customer.name} —É—à—ë–ª, –Ω–µ –Ω–∞–π–¥—è –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –ü–ö`, 'warning');
                    }
                } else if (customer.status === 'reserved') {
                    const pc = game.showcase.find(p => p.id === customer.targetPC);
                    if (pc && pc.reserved) {
                        customer.status = 'buying';
                        notify(`${customer.name} –ø—Ä–∏—à—ë–ª –∑–∞–±–∏—Ä–∞—Ç—å –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ü–ö!`, 'info');
                    }
                }
            });
            
            updateCustomerQueue();
            updateShowcase();
            saveGame();
        }
        
        function updateCustomerQueue() {
            const container = document.getElementById('customerQueue');
            document.getElementById('customerCount').textContent = game.customers.length;
            
            if (game.customers.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #6b7280;">–û—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞</div>';
                return;
            }
            
            container.innerHTML = game.customers.map(customer => {
                let statusText = '–°–º–æ—Ç—Ä–∏—Ç –≤–∏—Ç—Ä–∏–Ω—É';
                let statusClass = 'customer-waiting';
                let action = '';
                
                if (customer.status === 'reserved') {
                    statusText = `–ñ–¥—ë—Ç –ü–ö #${customer.targetPC.toString().slice(-4)}`;
                    statusClass = 'customer-waiting';
                } else if (customer.status === 'buying') {
                    statusText = '–ì–æ—Ç–æ–≤ –∫—É–ø–∏—Ç—å!';
                    statusClass = 'customer-ready';
                    action = `<button class="btn btn-success btn-small" onclick="sellToCustomer(${customer.id})">–ü—Ä–æ–¥–∞—Ç—å</button>`;
                }
                
                return `
                    <div class="customer-card ${statusClass}">
                        <div class="customer-info">
                            <div class="customer-name">${customer.name}</div>
                            <div class="customer-status">
                                ${statusText}<br>
                                –ë—é–¥–∂–µ—Ç: ‚Ç°${customer.budget.toLocaleString()} | 
                                –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ: ${customer.preferences}
                            </div>
                        </div>
                        <div class="customer-action">
                            ${action}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function sellToCustomer(customerId) {
            const customer = game.customers.find(c => c.id === customerId);
            const pc = game.showcase.find(p => p.id === customer.targetPC);
            
            if (!pc) return;
            
            // Higher prices for queue customers (30% markup instead of 20%)
            const sellPrice = Math.floor(pc.showcasePrice * 1.3);
            
            game.balance += sellPrice;
            const profit = sellPrice - pc.cost;
            addXP(Math.floor(profit / 800));
            game.reputation += 3;
            
            game.showcase = game.showcase.filter(p => p.id !== pc.id);
            game.customers = game.customers.filter(c => c.id !== customerId);
            
            updateUI();
            saveGame();
            notify(`–ü—Ä–æ–¥–∞–Ω–æ ${customer.name} –∑–∞ ‚Ç°${sellPrice.toLocaleString()}! (+30% –∫ —Ü–µ–Ω–µ)`, 'success');
        }

        // ========== SHOWCASE SYSTEM ==========
        
        function addToShowcase(pcId) {
            if (game.level < 4) {
                notify('–í–∏—Ç—Ä–∏–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Å 4 —É—Ä–æ–≤–Ω—è!', 'error');
                return;
            }
            
            if (game.showcase.length >= 5) {
                notify('–í–∏—Ç—Ä–∏–Ω–∞ –ø–æ–ª–Ω–∞ (–º–∞–∫—Å. 5 –ü–ö)', 'error');
                return;
            }
            
            const pc = game.inventory.find(p => p.id === pcId);
            if (!pc) return;
            
            game.inventory = game.inventory.filter(p => p.id !== pcId);
            game.showcase.push({
                ...pc,
                showcasePrice: Math.floor(pc.price * 1.2),
                listedDay: game.day,
                reserved: false,
                reservedBy: null
            });
            
            updateUI();
            saveGame();
            notify('–ü–ö –≤—ã—Å—Ç–∞–≤–ª–µ–Ω –Ω–∞ –≤–∏—Ç—Ä–∏–Ω—É!', 'success');
        }
        
        function removeFromShowcase(pcId) {
            const pc = game.showcase.find(p => p.id === pcId);
            if (!pc) return;
            
            if (pc.reserved) {
                notify('–ù–µ–ª—å–∑—è —Å–Ω—è—Ç—å –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ü–ö!', 'error');
                return;
            }
            
            game.showcase = game.showcase.filter(p => p.id !== pcId);
            game.inventory.push({...pc, price: pc.showcasePrice});
            
            updateUI();
            saveGame();
            notify('–ü–ö —Å–Ω—è—Ç —Å –≤–∏—Ç—Ä–∏–Ω—ã', 'info');
        }
        
        function updateShowcase() {
            const list = document.getElementById('showcaseList');
            document.getElementById('showcaseCount').textContent = game.showcase.length;
            
            if (game.showcase.length === 0) {
                list.innerHTML = '<div style="text-align: center; padding: 40px; color: #6b7280; grid-column: 1/-1;">–í–∏—Ç—Ä–∏–Ω–∞ –ø—É—Å—Ç–∞. –î–æ–±–∞–≤—å—Ç–µ –ü–ö –∏–∑ —Å–∫–ª–∞–¥–∞.</div>';
                return;
            }
            
            list.innerHTML = game.showcase.map(pc => {
                const daysListed = game.day - pc.listedDay;
                const markup = Math.floor((pc.showcasePrice / pc.price - 1) * 100);
                
                return `
                    <div class="showcase-item ${pc.reserved ? 'reserved' : ''}">
                        ${pc.reserved ? '<span class="showcase-badge reserved">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω</span>' : '<span class="showcase-badge">–í –ø—Ä–æ–¥–∞–∂–µ</span>'}
                        <div class="item-header" style="margin-top: 10px;">
                            <span class="item-title">–ü–ö #${pc.id.toString().slice(-4)}</span>
                            ${pc.reserved ? `<span style="color: #f59e0b; font-size: 0.85em;">${pc.reservedBy}</span>` : ''}
                        </div>
                        <div class="showcase-price">‚Ç°${pc.showcasePrice.toLocaleString()}</div>
                        <div class="showcase-profit">–ù–∞—Ü–µ–Ω–∫–∞: ${markup}% | –ü—Ä–∏–±—ã–ª—å: ‚Ç°${(pc.showcasePrice - pc.cost).toLocaleString()}</div>
                        <div class="showcase-components">
                            ${pc.components.cpu.name}<br>
                            ${pc.components.gpu.name}<br>
                            ${pc.components.ram.name}
                        </div>
                        <div class="showcase-actions">
                            ${!pc.reserved ? `
                                <button class="btn btn-warning btn-small" onclick="editShowcasePrice(${pc.id})" style="flex: 1;">
                                    üí∞ –¶–µ–Ω–∞
                                </button>
                                <button class="btn btn-danger btn-small" onclick="removeFromShowcase(${pc.id})" style="flex: 1;">
                                    üì¶ –°–Ω—è—Ç—å
                                </button>
                            ` : '<div style="color: #f59e0b; font-size: 0.85em; text-align: center; width: 100%;">–û–∂–∏–¥–∞–µ—Ç –ø–æ–∫—É–ø–∞—Ç–µ–ª—è</div>'}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function editShowcasePrice(pcId) {
            const pc = game.showcase.find(p => p.id === pcId);
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <h3 style="margin-bottom: 20px;">üí∞ –ò–∑–º–µ–Ω–∏—Ç—å —Ü–µ–Ω—É</h3>
                <p>–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å: ‚Ç°${pc.cost.toLocaleString()}</p>
                <p>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è: ‚Ç°${pc.price.toLocaleString()}</p>
                <div style="margin: 20px 0;">
                    <label>–ù–æ–≤–∞—è —Ü–µ–Ω–∞:</label>
                    <input type="number" id="newShowcasePrice" value="${pc.showcasePrice}" min="${pc.cost}" step="1000"
                           style="width: 100%; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #fff; padding: 10px; border-radius: 6px; margin-top: 10px;">
                </div>
                <button class="btn btn-success" onclick="saveShowcasePrice(${pc.id})" style="width: 100%;">
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            `;
            document.getElementById('modal').classList.add('active');
        }
        
        function saveShowcasePrice(pcId) {
            const pc = game.showcase.find(p => p.id === pcId);
            const newPrice = parseInt(document.getElementById('newShowcasePrice').value);
            
            if (newPrice < pc.cost) {
                notify('–¶–µ–Ω–∞ –Ω–∏–∂–µ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏!', 'error');
                return;
            }
            
            pc.showcasePrice = newPrice;
            closeModal();
            updateShowcase();
            saveGame();
            notify('–¶–µ–Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!', 'success');
        }

        // ========== BUILD SYSTEM ==========
        
        function checkCompatibility() {
            const b = game.currentBuild;
            const errors = {};
            let powerDraw = 0;
            
            if (b.cpu) powerDraw += b.cpu.tdp || 0;
            if (b.gpu) powerDraw += b.gpu.tdp || 0;
            if (b.ram) powerDraw += 10;
            if (b.storage) powerDraw += 7;
            if (b.motherboard) powerDraw += 15;
            if (b.fans) powerDraw += 5;
            
            let socketOk = null;
            if (b.cpu && b.motherboard) {
                socketOk = b.cpu.socket === b.motherboard.socket;
                if (!socketOk) {
                    errors.cpu = '–°–æ–∫–µ—Ç';
                    errors.motherboard = '–°–æ–∫–µ—Ç';
                }
            }
            
            let powerOk = null;
            if (b.psu) {
                powerOk = b.psu.wattage >= powerDraw * 1.2;
                if (!powerOk) errors.psu = `–ù—É–∂–Ω–æ ${Math.ceil(powerDraw * 1.2)}W`;
            }
            
            let formOk = null;
            if (b.motherboard && b.case) {
                const compatForms = { 'mATX': ['mATX'], 'ATX': ['mATX', 'ATX'], 'E-ATX': ['mATX', 'ATX', 'E-ATX'] };
                formOk = compatForms[b.case.formFactor]?.includes(b.motherboard.formFactor);
                if (!formOk) errors.motherboard = '–ù–µ –≤–ª–µ–∑–∞–µ—Ç';
            }
            
            let coolingOk = null;
            if (b.cpu && b.cooler) {
                coolingOk = b.cooler.maxTdp >= b.cpu.tdp;
                if (!coolingOk) errors.cooler = '–°–ª–∞–±—ã–π';
            }
            
            let sizeOk = true;
            let sizeErrors = [];
            
            if (b.gpu && b.case) {
                if (b.gpu.length > b.case.maxGpu) {
                    sizeOk = false;
                    sizeErrors.push(`GPU ${b.gpu.length} > ${b.case.maxGpu}`);
                    errors.gpu = '–î–ª–∏–Ω–Ω–∞—è';
                }
            }
            
            if (b.cooler && b.case && b.cooler.type === 'air') {
                if (b.cooler.height > b.case.maxCooler) {
                    sizeOk = false;
                    sizeErrors.push(`–ö—É–ª–µ—Ä ${b.cooler.height} > ${b.case.maxCooler}`);
                    errors.cooler = '–í—ã—Å–æ–∫–∏–π';
                }
            }
            
            if (b.psu && b.case) {
                if (b.psu.length > b.case.maxPsu) {
                    sizeOk = false;
                    sizeErrors.push(`–ë–ü ${b.psu.length} > ${b.case.maxPsu}`);
                    errors.psu = '–î–ª–∏–Ω–Ω—ã–π';
                }
            }
            
            let fansOk = null;
            if (b.fans && b.case) {
                fansOk = b.case.fanSlots.includes(b.fans.size);
                if (!fansOk) errors.fans = `–ù—É–∂–µ–Ω ${b.case.fanSlots.join('/')}`;
            }
            
            let waterOk = null;
            if (b.cooler && b.case && b.cooler.type === 'water') {
                waterOk = b.case.waterSupport.includes(b.cooler.radiator);
                if (!waterOk) errors.cooler = `–ù–µ—Ç ${b.cooler.radiator}–º–º`;
            }
            
            Object.keys(slotNames).forEach(type => {
                const errorDiv = document.getElementById(`error-${type}`);
                const slotDiv = document.getElementById(`slot-${type}-div`);
                if (errorDiv) {
                    if (errors[type]) {
                        errorDiv.textContent = errors[type];
                        slotDiv.classList.add('error');
                    } else {
                        errorDiv.textContent = '';
                        slotDiv.classList.remove('error');
                    }
                }
            });
            
            const compatInfo = document.getElementById('compatInfo');
            if (Object.values(b).some(x => x)) {
                compatInfo.style.display = 'block';
                document.getElementById('compatSocket').innerHTML = socketOk === null ? '‚Äî' : socketOk ? '<span class="compat-ok">‚úì</span>' : '<span class="compat-error">‚úó</span>';
                document.getElementById('compatPower').innerHTML = powerOk === null ? '‚Äî' : powerOk ? '<span class="compat-ok">‚úì</span>' : '<span class="compat-error">‚úó</span>';
                document.getElementById('compatForm').innerHTML = formOk === null ? '‚Äî' : formOk ? '<span class="compat-ok">‚úì</span>' : '<span class="compat-error">‚úó</span>';
                document.getElementById('compatCooling').innerHTML = coolingOk === null ? '‚Äî' : coolingOk ? '<span class="compat-ok">‚úì</span>' : '<span class="compat-warn">‚ö†</span>';
                document.getElementById('compatSize').innerHTML = sizeOk ? '<span class="compat-ok">‚úì</span>' : `<span class="compat-error">‚úó</span>`;
                document.getElementById('compatFans').innerHTML = fansOk === null ? '‚Äî' : fansOk ? '<span class="compat-ok">‚úì</span>' : '<span class="compat-error">‚úó</span>';
            }
            
            const statusDiv = document.getElementById('powerStatus');
            if (!b.cpu && !b.motherboard && !b.gpu && !b.psu) {
                statusDiv.className = 'power-status';
                statusDiv.textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–æ—Ç—ã';
            } else if (Object.keys(errors).length > 0) {
                statusDiv.className = 'power-status power-error';
                statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏!';
            } else if (powerOk === false) {
                statusDiv.className = 'power-status power-error';
                statusDiv.textContent = `‚ö† –ù—É–∂–Ω–æ ${Math.ceil(powerDraw * 1.2)}W`;
            } else if (socketOk && powerOk && formOk && coolingOk && sizeOk && fansOk !== false && waterOk !== false) {
                statusDiv.className = 'power-status power-ok';
                statusDiv.textContent = `‚úì –°–æ–≤–º–µ—Å—Ç–∏–º–æ. ${powerDraw}W`;
            } else {
                statusDiv.className = 'power-status power-warn';
                statusDiv.textContent = `${powerDraw}W. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ`;
            }
            
            document.getElementById('powerDraw').textContent = `${powerDraw}W`;
            
            const allFilled = Object.values(b).every(x => x);
            const noErrors = Object.keys(errors).length === 0 && sizeErrors.length === 0 && powerOk !== false && fansOk !== false && waterOk !== false;
            return allFilled && noErrors;
        }

        function switchCoolerTab(tab) {
            currentCoolerTab = tab;
            document.querySelectorAll('.cooler-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            selectSlot('cooler');
        }

        function selectSlot(type) {
            game.selectedSlot = type;
            
            document.querySelectorAll('.build-slot').forEach(s => s.classList.remove('active'));
            document.getElementById(`slot-${type}-div`).classList.add('active');
            
            const section = document.getElementById('componentsSection');
            section.classList.add('active');
            
            const coolerTabs = document.getElementById('coolerTabs');
            if (type === 'cooler') {
                coolerTabs.style.display = 'flex';
                document.getElementById('componentsTitle').textContent = `–í—ã–±–µ—Ä–∏—Ç–µ ${currentCoolerTab === 'air' ? '–≤–æ–∑–¥—É—à–Ω—ã–π' : '–≤–æ–¥—è–Ω–æ–π'} –∫—É–ª–µ—Ä`;
            } else {
                coolerTabs.style.display = 'none';
                document.getElementById('componentsTitle').textContent = `–í—ã–±–µ—Ä–∏—Ç–µ ${slotNames[type]}`;
            }
            
            const grid = document.getElementById('componentsGrid');
            let comps = allComponents[type];
            
            if (type === 'cooler') {
                comps = allComponents[`cooler_${currentCoolerTab}`];
            }
            
            // Filter by available tiers based on level
            const availableTiers = componentTiers[game.level] || ['budget'];
            comps = comps.filter(c => availableTiers.includes(c.tier));
            
            grid.innerHTML = comps.map(comp => {
                const canAfford = true;
                const isSelected = game.currentBuild[type]?.id === comp.id;
                
                let incompatible = false;
                
                if (type === 'cpu' && game.currentBuild.motherboard) {
                    if (comp.socket !== game.currentBuild.motherboard.socket) incompatible = true;
                }
                if (type === 'motherboard' && game.currentBuild.cpu) {
                    if (comp.socket !== game.currentBuild.cpu.socket) incompatible = true;
                }
                if (type === 'cooler' && game.currentBuild.cpu) {
                    if (comp.maxTdp < game.currentBuild.cpu.tdp) incompatible = true;
                }
                if (type === 'gpu' && game.currentBuild.case) {
                    if (comp.length > game.currentBuild.case.maxGpu) incompatible = true;
                }
                
                return `
                    <div class="component-card ${isSelected ? 'selected' : ''} ${incompatible ? 'incompatible' : ''}" 
                         onclick="${incompatible ? '' : `selectComponent('${type}', '${comp.id}')`}">
                        <div class="comp-tier tier-${comp.tier || 'mid'}">${comp.tier || 'mid'}</div>
                        <div class="comp-brand">${comp.brand}</div>
                        <div class="comp-name">${comp.name}</div>
                        <div class="comp-price">‚Ç°${comp.price.toLocaleString()}</div>
                        ${incompatible ? '<div class="comp-error">‚ö† –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ</div>' : ''}
                    </div>
                `;
            }).join('');
            
            section.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function selectComponent(type, id) {
            let comp;
            if (type === 'cooler') {
                comp = allComponents.cooler_air.find(c => c.id === id) || allComponents.cooler_water.find(c => c.id === id);
            } else {
                comp = allComponents[type].find(c => c.id === id);
            }
            
            if (!comp) return;
            
            game.currentBuild[type] = comp;
            updateBuildUI();
            selectSlot(type);
            notify(`${comp.name} –≤—ã–±—Ä–∞–Ω`, 'success');
        }

        function updateBuildUI() {
            Object.entries(game.currentBuild).forEach(([type, comp]) => {
                const div = document.getElementById(`slot-${type}-div`);
                const val = document.getElementById(`slot-${type}`);
                const price = document.getElementById(`price-${type}`);
                
                if (comp) {
                    div.classList.add('filled');
                    div.classList.remove('active');
                    val.textContent = comp.name;
                    price.textContent = `‚Ç°${comp.price.toLocaleString()}`;
                } else {
                    div.classList.remove('filled');
                    val.textContent = '–ù–∞–∂–º–∏—Ç–µ';
                    price.textContent = '';
                }
            });
            
            const cost = Object.values(game.currentBuild).reduce((a, c) => a + (c?.price || 0), 0);
            const price20 = Math.floor(cost * 1.20);
            
            document.getElementById('buildCost').textContent = `‚Ç°${cost.toLocaleString()}`;
            document.getElementById('marketPrice').textContent = `‚Ç°${Math.floor(cost * 1.25).toLocaleString()}`;
            document.getElementById('profit20').textContent = `‚Ç°${(price20 - cost).toLocaleString()}`;
            
            const canBuild = checkCompatibility();
            document.getElementById('finishBtn').disabled = !canBuild;
        }

        function finishBuild() {
            if (!checkCompatibility()) {
                notify('–ò—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏!', 'error');
                return;
            }
            
            const cost = Object.values(game.currentBuild).reduce((a, c) => a + c.price, 0);
            
            if (game.balance < cost) {
                notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –∫–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏—Ö!', 'error');
                return;
            }
            
            game.balance -= cost;
            
            const perf = Object.values(game.currentBuild).reduce((a, c) => a + (c?.perf || 50), 0) / 11;
            const pc = {
                id: Date.now(),
                components: {...game.currentBuild},
                cost,
                price: Math.floor(cost * 1.25),
                perf: Math.floor(perf)
            };
            
            game.inventory.push(pc);
            addXP(Math.floor(cost / 1000));
            
            document.getElementById('componentsSection').classList.remove('active');
            document.querySelectorAll('.build-slot').forEach(s => s.classList.remove('active'));
            
            Object.keys(game.currentBuild).forEach(k => game.currentBuild[k] = null);
            game.selectedSlot = null;
            document.querySelectorAll('.build-slot').forEach(s => s.classList.remove('error'));
            document.getElementById('compatInfo').style.display = 'none';
            document.getElementById('powerStatus').className = 'power-status';
            
            updateUI();
            saveGame();
            notify(`–ü–ö —Å–æ–±—Ä–∞–Ω! –°–ø–∏—Å–∞–Ω–æ ‚Ç°${cost.toLocaleString()}`, 'success');
            switchTab('inventory');
        }

        function clearBuild() {
            Object.keys(game.currentBuild).forEach(k => game.currentBuild[k] = null);
            game.selectedSlot = null;
            document.getElementById('componentsSection').classList.remove('active');
            document.querySelectorAll('.build-slot').forEach(s => {
                s.classList.remove('active', 'error');
                const err = s.querySelector('.slot-error');
                if (err) err.textContent = '';
            });
            document.getElementById('compatInfo').style.display = 'none';
            updateBuildUI();
            notify('–í—ã–±–æ—Ä –æ—á–∏—â–µ–Ω', 'info');
        }

        function updateInventory() {
            const list = document.getElementById('inventoryList');
            document.getElementById('invCount').textContent = game.inventory.length;
            
            if (game.inventory.length === 0) {
                list.innerHTML = '<div style="text-align: center; padding: 40px; color: #6b7280;">–°–∫–ª–∞–¥ –ø—É—Å—Ç</div>';
                return;
            }
            
            list.innerHTML = game.inventory.map(pc => `
                <div class="item-card">
                    <div class="item-header">
                        <span class="item-title">–ü–ö #${pc.id.toString().slice(-4)}</span>
                        <span class="item-price">‚Ç°${pc.price.toLocaleString()}</span>
                    </div>
                    <div class="item-details">
                        ${pc.components.cpu.name} + ${pc.components.gpu.name}<br>
                        –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å: ‚Ç°${pc.cost.toLocaleString()} | –ü—Ä–∏–±—ã–ª—å: ‚Ç°${(pc.price - pc.cost).toLocaleString()}
                    </div>
                    <div class="btn-row">
                        <button class="btn btn-success btn-small" onclick="sellPC(${pc.id})">–ü—Ä–æ–¥–∞—Ç—å</button>
                        ${game.level >= 4 ? `<button class="btn btn-warning btn-small" onclick="addToShowcase(${pc.id})">–ù–∞ –≤–∏—Ç—Ä–∏–Ω—É</button>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function sellPC(id) {
            const pc = game.inventory.find(p => p.id === id);
            game.balance += pc.price;
            game.reputation += 2;
            game.inventory = game.inventory.filter(p => p.id !== id);
            addXP(Math.floor(pc.price / 2000));
            updateUI();
            saveGame();
            notify(`–ü—Ä–æ–¥–∞–Ω–æ –∑–∞ ‚Ç°${pc.price.toLocaleString()}`, 'success');
        }

        function calculateAutoRate() {
            const baseRate = 10;
            const repBonus = Math.floor(game.reputation / 10) * 0.5;
            const levelBonus = (game.level - 1) * 0.5;
            return Math.max(1, baseRate - repBonus - levelBonus);
        }

        function updateLoan() {
            const amount = parseInt(document.getElementById('loanAmountInput').value) || 0;
            const days = parseInt(document.getElementById('loanDaysInput').value) || 1;
            
            const rate = calculateAutoRate();
            document.getElementById('rateDisplay').textContent = rate.toFixed(1) + '%';
            
            const total = Math.floor(amount * (1 + rate / 100));
            const daily = Math.floor(total / days);
            
            document.getElementById('totalRepay').textContent = `‚Ç°${total.toLocaleString()}`;
            document.getElementById('overpay').textContent = `‚Ç°${(total - amount).toLocaleString()}`;
            document.getElementById('dailyPay').textContent = `‚Ç°${daily.toLocaleString()}`;
            document.getElementById('interestRate').textContent = `${rate.toFixed(1)}%`;
            
            const maxLoan = game.level * 100000 + game.reputation * 5000;
            document.getElementById('maxLoan').textContent = `‚Ç°${maxLoan.toLocaleString()}`;
            
            const err = document.getElementById('loanError');
            const btn = document.getElementById('takeLoanBtn');
            
            if (amount > maxLoan) {
                err.textContent = `–ú–∞–∫—Å–∏–º—É–º ‚Ç°${maxLoan.toLocaleString()}`;
                err.style.display = 'block';
                btn.disabled = true;
            } else if (amount < 1000) {
                err.textContent = '–ú–∏–Ω–∏–º—É–º ‚Ç°1,000';
                err.style.display = 'block';
                btn.disabled = true;
            } else {
                err.style.display = 'none';
                btn.disabled = false;
            }
        }

        function takeLoan() {
            if (game.debt > 0) {
                notify('–£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –∫—Ä–µ–¥–∏—Ç!', 'error');
                return;
            }
            
            const amount = parseInt(document.getElementById('loanAmountInput').value);
            const days = parseInt(document.getElementById('loanDaysInput').value);
            const rate = calculateAutoRate();
            const total = Math.floor(amount * (1 + rate / 100));
            
            game.balance += amount;
            game.debt = total;
            game.debtTotal = total;
            game.dailyPayment = Math.floor(total / days);
            game.paymentsLeft = days;
            game.interestRate = rate;
            game.lastPaymentDate = new Date().toDateString();
            
            updateUI();
            saveGame();
            notify(`–ö—Ä–µ–¥–∏—Ç: ‚Ç°${amount.toLocaleString()} –ø–æ–¥ ${rate.toFixed(1)}%`, 'success');
        }

        function repayEarly() {
            const amount = Math.floor(game.debt * 0.9);
            if (game.balance < amount) {
                notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!', 'error');
                return;
            }
            
            game.balance -= amount;
            game.debt = 0;
            game.dailyPayment = 0;
            game.paymentsLeft = 0;
            game.reputation += 25;
            
            updateUI();
            saveGame();
            notify('–ö—Ä–µ–¥–∏—Ç –ø–æ–≥–∞—à–µ–Ω! +25‚òÖ', 'success');
        }

        function updateWorkers() {
            const container = document.getElementById('workersList');
            const totalSalaries = game.workers.reduce((a, w) => a + w.salary * w.count, 0);
            
            document.getElementById('totalSalaries').textContent = `‚Ç°${totalSalaries.toLocaleString()}`;
            
            const currentCounts = {};
            game.workers.forEach(w => {
                currentCounts[w.id] = w.count;
            });
            
            container.innerHTML = workers.map(w => {
                const current = currentCounts[w.id] || 0;
                const maxWorkers = w.max + Math.floor((game.level - w.minLevel) / 2);
                const canHire = game.level >= w.minLevel && current < maxWorkers;
                const isLocked = game.level < w.minLevel;
                
                return `
                    <div class="worker-card ${isLocked ? 'locked' : ''}">
                        <div class="worker-header">
                            <div>
                                <div class="worker-name">${w.name}</div>
                                <div style="font-size: 0.85em; color: #9ca3af;">${w.desc}</div>
                            </div>
                            <div class="worker-salary">‚Ç°${w.salary.toLocaleString()}/–¥–µ–Ω—å</div>
                        </div>
                        <div class="worker-stats">
                            <div class="worker-stat">
                                <div class="worker-stat-value">‚Ç°${w.profit.toLocaleString()}</div>
                                <div style="font-size: 0.75em; color: #9ca3af;">–ü—Ä–∏–±—ã–ª—å</div>
                            </div>
                            <div class="worker-stat">
                                <div class="worker-stat-value">${w.speed}x</div>
                                <div style="font-size: 0.75em; color: #9ca3af;">–°–∫–æ—Ä–æ—Å—Ç—å</div>
                            </div>
                            <div class="worker-stat">
                                <div class="worker-stat-value">${current}/${maxWorkers}</div>
                                <div style="font-size: 0.75em; color: #9ca3af;">–ù–∞–Ω—è—Ç–æ</div>
                            </div>
                        </div>
                        ${isLocked ? 
                            `<div class="unlock-requirement">üîí –£—Ä–æ–≤–µ–Ω—å ${w.minLevel}</div>` :
                            `<div class="btn-row">
                                <button class="btn btn-success btn-small" onclick="hireWorker('${w.id}')" ${!canHire ? 'disabled' : ''}>
                                    –ù–∞–Ω—è—Ç—å (‚Ç°${(w.salary * 7).toLocaleString()})
                                </button>
                                <button class="btn btn-danger btn-small" onclick="fireWorker('${w.id}')" ${current === 0 ? 'disabled' : ''}>
                                    –£–≤–æ–ª–∏—Ç—å
                                </button>
                            </div>`
                        }
                    </div>
                `;
            }).join('');
        }

        function hireWorker(id) {
            const worker = workers.find(w => w.id === id);
            const cost = worker.salary * 7;
            
            if (game.balance < cost) {
                notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!', 'error');
                return;
            }
            
            game.balance -= cost;
            
            const existing = game.workers.find(w => w.id === id);
            if (existing) {
                existing.count++;
            } else {
                game.workers.push({...worker, count: 1});
            }
            
            updateUI();
            saveGame();
            notify(`${worker.name} –Ω–∞–Ω—è—Ç!`, 'success');
        }

        function fireWorker(id) {
            const existing = game.workers.find(w => w.id === id);
            if (existing && existing.count > 0) {
                existing.count--;
                if (existing.count === 0) {
                    game.workers = game.workers.filter(w => w.id !== id);
                }
                updateUI();
                saveGame();
                notify('–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —É–≤–æ–ª–µ–Ω', 'warning');
            }
        }

        function updateNextPayment() {
            if (game.debt <= 0) return;
            
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0);
            
            const diff = tomorrow - now;
            const hours = Math.floor(diff / 3600000);
            const minutes = Math.floor((diff % 3600000) / 60000);
            const seconds = Math.floor((diff % 60000) / 1000);
            
            const elem = document.getElementById('nextPayment');
            if (elem) {
                elem.textContent = `–°–ª–µ–¥—É—é—â–∏–π –ø–ª–∞—Ç—ë–∂: ${hours}—á ${minutes}–º ${seconds}—Å`;
            }
        }

        function updateUI() {
            document.getElementById('balance').textContent = `‚Ç°${game.balance.toLocaleString()}`;
            document.getElementById('reputation').textContent = game.reputation;
            
            if (game.debt > 0) {
                document.getElementById('debtStat').style.display = 'flex';
                document.getElementById('debt').textContent = `‚Ç°${game.debt.toLocaleString()}`;
                document.getElementById('activeLoan').style.display = 'block';
                document.getElementById('newLoan').style.display = 'none';
                document.getElementById('loanRemaining').textContent = `‚Ç°${game.debt.toLocaleString()}`;
                document.getElementById('loanDaily').textContent = `‚Ç°${game.dailyPayment.toLocaleString()}`;
                document.getElementById('loanDaysLeft').textContent = `${game.paymentsLeft} –¥–Ω–µ–π`;
            } else {
                document.getElementById('debtStat').style.display = 'none';
                document.getElementById('activeLoan').style.display = 'none';
                document.getElementById('newLoan').style.display = 'block';
            }
            
            updateLevelUI();
            updateInventory();
            updateNPCList();
            updateShowcase();
            updateWorkers();
            updateWorkerTasks();
            updateCustomerQueue();
            updateBuildUI();
            updateLoan();
        }

        function switchTab(tab) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab).classList.add('active');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        function closeAdminUserModal() {
            document.getElementById('adminUserModal').classList.remove('active');
        }

        function notify(text, type) {
            const n = document.getElementById('notification');
            n.textContent = text;
            n.className = `notification ${type} show`;
            setTimeout(() => n.classList.remove('show'), 3000);
        }

        window.onclick = (e) => {
            if (e.target === document.getElementById('modal')) closeModal();
            if (e.target === document.getElementById('changePasswordModal')) closeChangePasswordModal();
            if (e.target === document.getElementById('adminUserModal')) closeAdminUserModal();
            if (e.target === document.getElementById('giftModal')) closeGiftModal();
        };

        // Initialize auth on load
        window.onload = initAuth;
    </script>
</body>
</html>
